import{C as A,a as F}from"./opencc-C1Qz6KEM.js";import{t as k,a as H,b as O}from"./teamcraft-data-u2h6--oi.js";const j=A({from:"t",to:"cn"}),V=F({from:"cn",to:"t"});function q(e){if(!e)return e;try{return j(e)}catch(t){return console.error("Error converting to Simplified Chinese:",t),e}}function x(e){if(!e)return e;try{return V(e)}catch(t){return console.error("Error converting Simplified to Traditional:",t),e}}function Q(e){return e?q(e)!==e:!1}function Y(e){return e?/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e):!1}let C=null,v=null,N=!1;const U=new Map;let R=null,D=!1,g=null;async function _(e=null){if(R)return R;if(D){for(;D;)await new Promise(t=>setTimeout(t,100));return R}D=!0;try{!e&&g&&g.abort();let t,i;e?i=e:(t=new AbortController,g=t,i=t.signal);const r=await fetch("https://raw.githubusercontent.com/thewakingsands/ffxiv-datamining-cn/master/Item.csv",{signal:i});if(!r.ok)throw new Error(`HTTP ${r.status}`);const n=await r.text(),a=n.indexOf(`
`),c=n.indexOf(`
`,a+1),f=n.indexOf(`
`,c+1),y=n.indexOf(`
`,f+1),s=n.slice(0,a).split(","),l=n.slice(a+1,c).split(",");return R=n.slice(y+1).split(`
`).filter(u=>u.trim()).map(u=>{const d=X(u),p={};return s.forEach((S,h)=>{if(h<l.length){const m=`${S}: ${l[h]}`;p[m]=h<d.length&&d[h]!==void 0?d[h]:""}}),p}).filter(u=>Object.keys(u).length>0),D=!1,e||(g=null),R}catch(t){if(D=!1,e||(g=null),t.name==="AbortError")return null;throw console.error("Failed to load Simplified Chinese item database:",t),t}}function X(e){const t=[];let i="",r=!1;for(let n=0;n<e.length;n++){const a=e[n];a==='"'?r=!r:a===","&&!r?(t.push(i),i=""):i+=a}return t.push(i),t.map(n=>n.trim())}async function Z(e,t=null){if(!e||e<=0)return null;if(U.has(e))return U.get(e);try{const i=await _(t);if(!i)return null;const r=i.find(c=>{const f=c["key: #"];return f&&parseInt(f,10)===e});if(!r)return null;let n=r["9: Name"]||"";if((!n||n.trim()==="")&&(n=r["0: Singular"]||""),!n||n.trim()==="")return null;const a=n.replace(/^["']|["']$/g,"").trim();return a&&U.set(e,a),a}catch(i){return i.name==="AbortError"||console.error(`Failed to get Simplified Chinese name for item ${e}:`,i),null}}function ee(){g&&(g.abort(),g=null,D=!1)}async function B(){if(C&&v)return{items:C,shopItems:v};if(N){for(;N;)await new Promise(e=>setTimeout(e,100));return{items:C,shopItems:v}}N=!0;try{return C=Object.entries(H).map(([t,i])=>{const r=i.tw||"";return{"key: #":t,"9: Name":r,"0: Singular":r,"11: Level{Item}":"","25: Price{Mid}":"","8: Description":"","22: IsUntradable":"False","27: CanBeHq":"True"}}).filter(t=>t["key: #"]&&t["9: Name"].trim()!==""),v=[],N=!1,{items:C,shopItems:v}}catch(e){throw N=!1,console.error("Failed to load item database:",e),e}}async function te(e){if(!e||e.trim()==="")return[];const{items:t,shopItems:i}=await B(),r=e.trim(),n=Q(r)?r:x(r),c=n.includes(" ")?n.split(/\s+/).filter(s=>s):[n],f=new Set;return i.forEach(s=>{const l=s["0: Item"];l&&f.add(l)}),t.filter(s=>{let l=s["9: Name"]||"";(!l||l.trim()==="")&&(l=s["0: Singular"]||"");const o=(s["22: IsUntradable"]||"").toString().trim(),b=o==="True"||o==="true"||o==="TRUE"||o==="1";s["key: #"];const u=l.includes("地图");if(!l||l.trim()===""||b)return!1;let d=l.replace(/^["']+|["']+$/g,"").trim();if(!d)return!1;const p=c.every(S=>d.includes(S));return p||u||d.includes("地圖"),p}).map(s=>{const l=s["key: #"];let o=s["9: Name"]||"";(!o||o.trim()==="")&&(o=s["0: Singular"]||"");const b=s["11: Level{Item}"]||"",u=s["25: Price{Mid}"]||"",d=s["27: CanBeHq"]!=="False",p=f.has(l),h=k[l]?.tw||"",m=(s["22: IsUntradable"]||"").toString().trim(),M=!(m==="True"||m==="true"||m==="TRUE"||m==="1"),$=o.replace(/^["']|["']$/g,"").trim(),P=h.replace(/^["']|["']$/g,"").trim();return{id:parseInt(l,10)||0,name:$,nameSimplified:$,itemLevel:b,shopPrice:u,description:P,inShop:p,canBeHQ:d,isTradable:M}}).filter(s=>s.id>0).sort((s,l)=>{const o=(l.isTradable?1:0)-(s.isTradable?1:0);return o!==0?o:s.id-l.id})}async function ne(e){if(!e||e<=0)return null;const{items:t,shopItems:i}=await B(),r=new Set;i.forEach(m=>{const T=m["0: Item"];T&&r.add(T)});const n=t.find(m=>{const T=m["key: #"];return T&&parseInt(T,10)===e});if(!n)return null;const a=n["key: #"];let c=n["9: Name"]||"";(!c||c.trim()==="")&&(c=n["0: Singular"]||"");const f=n["11: Level{Item}"]||"",y=n["25: Price{Mid}"]||"",s=n["27: CanBeHq"]!=="False",l=r.has(a),b=k[a]?.tw||"",u=(n["22: IsUntradable"]||"").toString().trim(),p=!(u==="True"||u==="true"||u==="TRUE"||u==="1"),S=c.replace(/^["']|["']$/g,"").trim(),h=b.replace(/^["']|["']$/g,"").trim();return{id:parseInt(a,10)||0,name:S,nameSimplified:S,itemLevel:f,shopPrice:y,description:h,inShop:l,canBeHQ:s,isTradable:p}}let I=null,w=null,E=!1;async function L(){if(I&&w)return{recipes:I,byResult:w};if(E){for(;E;)await new Promise(e=>setTimeout(e,100));return{recipes:I,byResult:w}}E=!0;try{return I=O,w=new Map,I.forEach(e=>{e.result&&(w.has(e.result)||w.set(e.result,[]),w.get(e.result).push(e))}),E=!1,{recipes:I,byResult:w}}catch(e){throw E=!1,console.error("Failed to load recipe database:",e),e}}async function z(e){if(!e||e<=0)return[];const{byResult:t}=await L();return t.get(e)||[]}async function re(e){if(!e||e<=0)return!1;const{byResult:t}=await L();return t.has(e)}const G=new Set([2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);async function J(e,t=1,i=new Set,r=0){if(i.has(e)||r>10)return{itemId:e,amount:t,children:[],isCyclic:i.has(e),maxDepthReached:r>10};const n=await z(e);if(n.length===0)return{itemId:e,amount:t,children:[],isBaseMaterial:!0};const a=n[0],c=new Set(i);c.add(e);const f=a.yields||1,y=Math.ceil(t/f),s=a.ingredients.filter(o=>!G.has(o.id)),l=await Promise.all(s.map(async o=>{const b=o.amount*y;return await J(o.id,b,c,r+1)}));return{itemId:e,amount:t,recipeId:a.id,job:a.job,level:a.lvl,yields:f,craftsNeeded:y,children:l,isBaseMaterial:!1}}async function ie(e){if(!e||e<=0)return[];const{recipes:t}=await L(),i=new Set;return t.forEach(r=>{r.ingredients&&Array.isArray(r.ingredients)&&r.ingredients.some(a=>a.id===e)&&r.result&&i.add(r.result)}),Array.from(i)}export{ee as a,Z as b,Y as c,J as d,ie as f,ne as g,re as h,L as l,te as s};
