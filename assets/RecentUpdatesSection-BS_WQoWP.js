import{r as o,j as t}from"./react-vendor-DmEpS5Kz.js";import{c as w,d as j}from"./index-FzWq66Hl.js";import{g as y}from"./services-data-rxdqLngZ.js";import"./vendor-dPMYpV4t.js";import"./axios-B9ygI19o.js";import"./opencc-C1Qz6KEM.js";import"./teamcraft-data-u2h6--oi.js";function E({onItemSelect:c,selectedDcName:a}){const[d,u]=o.useState([]),[i,l]=o.useState(!1),[h,g]=o.useState(0),s=o.useRef(null),n=o.useRef(!1),p=3e3,f=async()=>{if(!(!a||i)){s.current&&s.current.abort(),s.current=new AbortController,l(!0);try{const e=await j(a,10,{signal:s.current.signal});if(!e||e.length===0){u([]),l(!1);return}const m=await Promise.all(e.map(async r=>{try{const x=await y(r.itemID);return{...r,name:x?.name||`物品 #${r.itemID}`,itemDetails:x}}catch{return{...r,name:`物品 #${r.itemID}`,itemDetails:null}}}));u(m.filter(r=>r.itemDetails))}catch(e){e.name!=="AbortError"&&console.error("Failed to fetch recent items:",e)}finally{l(!1)}}};o.useEffect(()=>(a&&f(),()=>{s.current&&s.current.abort()}),[a]);const b=()=>{const e=Date.now(),m=e-h;n.current||m<p||(n.current=!0,g(e),f(),setTimeout(()=>{n.current=!1},p))},v=e=>{c&&e.itemDetails&&c(e.itemDetails)};return a?t.jsxs("div",{className:"mb-6 bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4 sm:p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-ffxiv-gold flex items-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 sm:h-6 sm:w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"最近更新的物品"]}),t.jsxs("button",{onClick:b,disabled:n.current||i,className:`px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium rounded-md border transition-all duration-200 flex items-center gap-1.5 ${n.current||i?"bg-slate-700/60 text-gray-500 border-slate-600/40 cursor-not-allowed":"bg-purple-800/60 hover:bg-purple-700/70 text-gray-200 hover:text-white border-purple-500/40 hover:border-purple-400/60"}`,title:n.current?"請稍候再試":"刷新",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3.5 w-3.5 sm:h-4 sm:w-4 ${i?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),t.jsx("span",{children:"刷新"})]})]}),i?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-ffxiv-gold"}),t.jsx("span",{className:"ml-3 text-sm text-gray-400",children:"載入中..."})]}):d.length===0?t.jsx("div",{className:"py-8 text-center text-sm text-gray-400",children:"暫無數據"}):t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4",children:d.map(e=>t.jsx("button",{onClick:()=>v(e),className:"bg-gradient-to-br from-purple-900/30 via-pink-900/20 to-indigo-900/30 rounded-lg p-3 sm:p-4 border border-purple-500/30 hover:border-ffxiv-gold/50 transition-all hover:scale-105 group",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx(w,{itemId:e.itemID,alt:e.name,className:"w-12 h-12 sm:w-16 sm:h-16 object-contain rounded border border-purple-500/30 bg-slate-900/50 group-hover:border-ffxiv-gold/50 transition-colors"}),t.jsx("p",{className:"text-xs sm:text-sm text-white font-medium text-center line-clamp-2 group-hover:text-ffxiv-gold transition-colors",title:e.name,children:e.name})]})},e.itemID))})]}):null}export{E as default};
