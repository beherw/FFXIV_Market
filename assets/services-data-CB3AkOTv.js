import{C as H,a as O}from"./opencc-C1Qz6KEM.js";import{t as x,a as Q,b as V}from"./teamcraft-data-u2h6--oi.js";const q=H({from:"t",to:"cn"}),z=O({from:"cn",to:"t"});function j(e){if(!e)return e;try{return q(e)}catch(t){return console.error("Error converting to Simplified Chinese:",t),e}}function _(e){if(!e)return e;try{return z(e)}catch(t){return console.error("Error converting Simplified to Traditional:",t),e}}function Y(e){return e?j(e)!==e:!1}function te(e){return e?/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e):!1}let R=null,L=null,N=!1;const B=new Map;let M=null,D=!1,I=null;async function G(e=null){if(M)return M;if(D){for(;D;)await new Promise(t=>setTimeout(t,100));return M}D=!0;try{!e&&I&&I.abort();let t,i;e?i=e:(t=new AbortController,I=t,i=t.signal);const r=await fetch("https://raw.githubusercontent.com/thewakingsands/ffxiv-datamining-cn/master/Item.csv",{signal:i});if(!r.ok)throw new Error(`HTTP ${r.status}`);const n=await r.text(),s=n.indexOf(`
`),c=n.indexOf(`
`,s+1),m=n.indexOf(`
`,c+1),b=n.indexOf(`
`,m+1),l=n.slice(0,s).split(","),a=n.slice(s+1,c).split(",");return M=n.slice(b+1).split(`
`).filter(f=>f.trim()).map(f=>{const o=J(f),p={};return l.forEach((y,h)=>{if(h<a.length){const g=`${y}: ${a[h]}`;p[g]=h<o.length&&o[h]!==void 0?o[h]:""}}),p}).filter(f=>Object.keys(f).length>0),D=!1,e||(I=null),M}catch(t){if(D=!1,e||(I=null),t.name==="AbortError")return null;throw console.error("Failed to load Simplified Chinese item database:",t),t}}function J(e){const t=[];let i="",r=!1;for(let n=0;n<e.length;n++){const s=e[n];s==='"'?r=!r:s===","&&!r?(t.push(i),i=""):i+=s}return t.push(i),t.map(n=>n.trim())}async function ne(e,t=null){if(!e||e<=0)return null;if(B.has(e))return B.get(e);try{const i=await G(t);if(!i)return null;const r=i.find(c=>{const m=c["key: #"];return m&&parseInt(m,10)===e});if(!r)return null;let n=r["9: Name"]||"";if((!n||n.trim()==="")&&(n=r["0: Singular"]||""),!n||n.trim()==="")return null;const s=n.replace(/^["']|["']$/g,"").trim();return s&&B.set(e,s),s}catch(i){return i.name==="AbortError"||console.error(`Failed to get Simplified Chinese name for item ${e}:`,i),null}}function re(){I&&(I.abort(),I=null,D=!1)}async function F(){if(R&&L)return{items:R,shopItems:L};if(N){for(;N;)await new Promise(e=>setTimeout(e,100));return{items:R,shopItems:L}}N=!0;try{return R=Object.entries(Q).map(([t,i])=>{const r=i.tw||"";return{"key: #":t,"9: Name":r,"0: Singular":r,"11: Level{Item}":"","25: Price{Mid}":"","8: Description":"","22: IsUntradable":"False","27: CanBeHq":"True"}}).filter(t=>t["key: #"]&&t["9: Name"].trim()!==""),L=[],N=!1,{items:R,shopItems:L}}catch(e){throw N=!1,console.error("Failed to load item database:",e),e}}function K(e,t){const i=Array.from(e.toLowerCase()),r=Array.from(t.toLowerCase());if(t.toLowerCase().includes(e.toLowerCase()))return 1;let n=0,s=0,c=0,m=0;for(let u=0;u<i.length;u++){const d=i[u];let f=!1;for(let o=s;o<r.length;o++)if(r[o]===d){n++,f=!0,o===s?(c++,m=Math.max(m,c)):c=1,s=o+1;break}if(!f){for(let o=0;o<r.length;o++)if(r[o]===d){n++,f=!0,c=1,s=o+1;break}}f||(c=0)}const b=n/i.length,l=m/i.length*.3,a=b*.7+l;return a>=.6?a:0}function $(e,t,i,r,n=!1){const s=r.trim(),m=s.includes(" ")?s.split(/\s+/).filter(l=>l):[s];return e.filter(l=>{let a=l["9: Name"]||"";(!a||a.trim()==="")&&(a=l["0: Singular"]||"");const u=(l["22: IsUntradable"]||"").toString().trim(),d=u==="True"||u==="true"||u==="TRUE"||u==="1";l["key: #"];const f=a.includes("地图");if(!a||a.trim()===""||d)return!1;let o=a.replace(/^["']+|["']+$/g,"").trim();if(!o)return!1;let p=!1;return n?p=m.map(h=>K(h,o)).every(h=>h>0):p=m.every(y=>o.includes(y)),p||f||o.includes("地圖"),p}).map(l=>{const a=l["key: #"];let u=l["9: Name"]||"";(!u||u.trim()==="")&&(u=l["0: Singular"]||"");const d=l["11: Level{Item}"]||"",f=l["25: Price{Mid}"]||"",o=l["27: CanBeHq"]!=="False",p=i.has(a),h=x[a]?.tw||"",g=(l["22: IsUntradable"]||"").toString().trim(),S=!(g==="True"||g==="true"||g==="TRUE"||g==="1"),C=u.replace(/^["']|["']$/g,"").trim(),k=h.replace(/^["']|["']$/g,"").trim();return{id:parseInt(a,10)||0,name:C,nameSimplified:C,itemLevel:d,shopPrice:f,description:k,inShop:p,canBeHQ:o,isTradable:S}}).filter(l=>l.id>0).sort((l,a)=>{const u=(a.isTradable?1:0)-(l.isTradable?1:0);return u!==0?u:l.id-a.id})}async function se(e,t=!1){if(!e||e.trim()==="")return{results:[],converted:!1,originalText:"",convertedText:null};const{items:i,shopItems:r}=await F(),n=new Set;r.forEach(a=>{const u=a["0: Item"];u&&n.add(u)});const s=e.trim();let c=$(i,r,n,s,t),m=!1,b=s,l=null;if(c.length===0&&!t){const a=Y(s)?j(s):_(s);a!==s&&(m=!0,l=a,c=$(i,r,n,a,t))}return{results:c,converted:m,originalText:b,convertedText:l}}async function ie(e){if(!e||e<=0)return null;const{items:t,shopItems:i}=await F(),r=new Set;i.forEach(g=>{const w=g["0: Item"];w&&r.add(w)});const n=t.find(g=>{const w=g["key: #"];return w&&parseInt(w,10)===e});if(!n)return null;const s=n["key: #"];let c=n["9: Name"]||"";(!c||c.trim()==="")&&(c=n["0: Singular"]||"");const m=n["11: Level{Item}"]||"",b=n["25: Price{Mid}"]||"",l=n["27: CanBeHq"]!=="False",a=r.has(s),d=x[s]?.tw||"",f=(n["22: IsUntradable"]||"").toString().trim(),p=!(f==="True"||f==="true"||f==="TRUE"||f==="1"),y=c.replace(/^["']|["']$/g,"").trim(),h=d.replace(/^["']|["']$/g,"").trim();return{id:parseInt(s,10)||0,name:y,nameSimplified:y,itemLevel:m,shopPrice:b,description:h,inShop:a,canBeHQ:l,isTradable:p}}let v=null,T=null,E=!1;async function A(){if(v&&T)return{recipes:v,byResult:T};if(E){for(;E;)await new Promise(e=>setTimeout(e,100));return{recipes:v,byResult:T}}E=!0;try{return v=V,T=new Map,v.forEach(e=>{e.result&&(T.has(e.result)||T.set(e.result,[]),T.get(e.result).push(e))}),E=!1,{recipes:v,byResult:T}}catch(e){throw E=!1,console.error("Failed to load recipe database:",e),e}}async function W(e){if(!e||e<=0)return[];const{byResult:t}=await A();return t.get(e)||[]}async function ae(e){if(!e||e<=0)return!1;const{byResult:t}=await A();return t.has(e)}const P=new Set([2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);async function X(e,t=1,i=new Set,r=0,n=!0){if(i.has(e)||r>10)return{itemId:e,amount:t,children:[],isCyclic:i.has(e),maxDepthReached:r>10};const s=await W(e);if(s.length===0)return{itemId:e,amount:t,children:[],isBaseMaterial:!0};const c=s[0],m=new Set(i);m.add(e);const b=c.yields||1,l=Math.ceil(t/b);let a=n?c.ingredients.filter(d=>!P.has(d.id)):c.ingredients;if(!n&&c.ingredients.length>0){const d=c.ingredients.filter(o=>!P.has(o.id)),f=c.ingredients.filter(o=>P.has(o.id));if(d.length>0&&f.length>0){const o=[],p=f.length,h=d.length-1,g=h>0?Math.floor(p/h):0,w=h>0?p%h:p;let S=0;for(let C=0;C<d.length;C++)if(o.push(d[C]),C<d.length-1){const k=g+(C<w?1:0);for(let U=0;U<k&&S<f.length;U++)o.push(f[S]),S++}for(;S<f.length;)o.push(f[S]),S++;a=o}else f.length>0&&d.length===0&&(a=f)}const u=await Promise.all(a.map(async d=>{const f=d.amount*l;return await X(d.id,f,m,r+1,n)}));return{itemId:e,amount:t,recipeId:c.id,job:c.job,level:c.lvl,yields:b,craftsNeeded:l,children:u,isBaseMaterial:!1}}async function le(e){if(!e||e<=0)return[];const{recipes:t}=await A(),i=new Set;return t.forEach(r=>{r.ingredients&&Array.isArray(r.ingredients)&&r.ingredients.some(s=>s.id===e)&&r.result&&i.add(r.result)}),Array.from(i)}export{re as a,ne as b,te as c,X as d,le as f,ie as g,ae as h,A as l,se as s};
