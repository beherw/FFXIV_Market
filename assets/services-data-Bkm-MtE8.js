import{C as G,a as J}from"./opencc-C1Qz6KEM.js";import{t as x,a as K,b as W}from"./teamcraft-data-u2h6--oi.js";const X=G({from:"t",to:"cn"}),Z=J({from:"cn",to:"t"});function H(e){if(!e)return e;try{return X(e)}catch(t){return console.error("Error converting to Simplified Chinese:",t),e}}function Q(e){if(!e)return e;try{return Z(e)}catch(t){return console.error("Error converting Simplified to Traditional:",t),e}}function z(e){return e?H(e)!==e:!1}function O(e){return e?/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e):!1}let N=null,R=null,L=!1;const $=new Map;let B=null,D=!1,C=null;async function V(e=null){if(B)return B;if(D){for(;D;)await new Promise(t=>setTimeout(t,100));return B}D=!0;try{!e&&C&&C.abort();let t,i;e?i=e:(t=new AbortController,C=t,i=t.signal);const a=await fetch("https://raw.githubusercontent.com/thewakingsands/ffxiv-datamining-cn/master/Item.csv",{signal:i});if(!a.ok)throw new Error(`HTTP ${a.status}`);const n=await a.text(),s=n.indexOf(`
`),r=n.indexOf(`
`,s+1),d=n.indexOf(`
`,r+1),b=n.indexOf(`
`,d+1),o=n.slice(0,s).split(","),c=n.slice(s+1,r).split(",");return B=n.slice(b+1).split(`
`).filter(l=>l.trim()).map(l=>{const h=ee(l),u={};return o.forEach((g,m)=>{if(m<c.length){const y=`${g}: ${c[m]}`;u[y]=m<h.length&&h[m]!==void 0?h[m]:""}}),u}).filter(l=>Object.keys(l).length>0),D=!1,e||(C=null),B}catch(t){if(D=!1,e||(C=null),t.name==="AbortError")return null;throw console.error("Failed to load Simplified Chinese item database:",t),t}}function ee(e){const t=[];let i="",a=!1;for(let n=0;n<e.length;n++){const s=e[n];s==='"'?a=!a:s===","&&!a?(t.push(i),i=""):i+=s}return t.push(i),t.map(n=>n.trim())}async function oe(e,t=null){if(!e||e<=0)return null;if($.has(e))return $.get(e);try{const i=await V(t);if(!i)return null;const a=i.find(r=>{const d=r["key: #"];return d&&parseInt(d,10)===e});if(!a)return null;let n=a["9: Name"]||"";if((!n||n.trim()==="")&&(n=a["0: Singular"]||""),!n||n.trim()==="")return null;const s=n.replace(/^["']|["']$/g,"").trim();return s&&$.set(e,s),s}catch(i){return i.name==="AbortError"||console.error(`Failed to get Simplified Chinese name for item ${e}:`,i),null}}function ce(){C&&(C.abort(),C=null,D=!1)}async function te(e){if(!e||e.trim()==="")return[];try{const t=await V();if(!t)return[];const i=e.trim(),n=i.includes(" ")?i.split(/\s+/).filter(r=>r):[i];return t.filter(r=>{let d=r["9: Name"]||"";if((!d||d.trim()==="")&&(d=r["0: Singular"]||""),!d||d.trim()==="")return!1;const b=d.replace(/^["']+|["']+$/g,"").trim();return b?n.every(c=>b.includes(c)):!1}).map(r=>{const d=r["key: #"];return d?parseInt(d,10):null}).filter(r=>r!==null&&r>0)}catch(t){return console.error("Failed to search simplified database:",t),[]}}async function q(){if(N&&R)return{items:N,shopItems:R};if(L){for(;L;)await new Promise(e=>setTimeout(e,100));return{items:N,shopItems:R}}L=!0;try{return N=Object.entries(K).map(([t,i])=>{const a=i.tw||"";return{"key: #":t,"9: Name":a,"0: Singular":a,"11: Level{Item}":"","25: Price{Mid}":"","8: Description":"","22: IsUntradable":"False","27: CanBeHq":"True"}}).filter(t=>t["key: #"]&&t["9: Name"].trim()!==""),R=[],L=!1,{items:N,shopItems:R}}catch(e){throw L=!1,console.error("Failed to load item database:",e),e}}function ne(e,t){const i=Array.from(e.toLowerCase()),a=Array.from(t.toLowerCase());if(t.toLowerCase().includes(e.toLowerCase()))return 1;let n=0,s=0;for(let d=0;d<i.length;d++){const b=i[d];let o=!1;for(let c=n;c<a.length;c++)if(a[c]===b){s++,o=!0,n=c+1;break}if(!o)return 0}return s/i.length===1?1:0}function P(e,t,i,a,n=!1){const s=a.trim(),r=s.includes(" "),d=r?s.split(/\s+/).filter(o=>o):[s];return e.filter(o=>{let c=o["9: Name"]||"";(!c||c.trim()==="")&&(c=o["0: Singular"]||"");const p=(o["22: IsUntradable"]||"").toString().trim(),f=p==="True"||p==="true"||p==="TRUE"||p==="1";o["key: #"];const l=c.includes("地图");if(!c||c.trim()===""||f)return!1;let h=c.replace(/^["']+|["']+$/g,"").trim();if(!h)return!1;let u=!1;return n&&r?u=d.map(m=>ne(m,h)).every(m=>m>0):u=d.every(g=>h.includes(g)),u||l||h.includes("地圖"),u}).map(o=>{const c=o["key: #"];let p=o["9: Name"]||"";(!p||p.trim()==="")&&(p=o["0: Singular"]||"");const f=o["11: Level{Item}"]||"",l=o["25: Price{Mid}"]||"",h=o["27: CanBeHq"]!=="False",u=i.has(c),m=x[c]?.tw||"",y=(o["22: IsUntradable"]||"").toString().trim(),w=!(y==="True"||y==="true"||y==="TRUE"||y==="1"),T=p.replace(/^["']|["']$/g,"").trim(),k=m.replace(/^["']|["']$/g,"").trim();return{id:parseInt(c,10)||0,name:T,nameSimplified:T,itemLevel:f,shopPrice:l,description:k,inShop:u,canBeHQ:h,isTradable:w}}).filter(o=>o.id>0).sort((o,c)=>{const p=(c.isTradable?1:0)-(o.isTradable?1:0);return p!==0?p:o.id-c.id})}async function fe(e,t=!1){if(!e||e.trim()==="")return{results:[],converted:!1,originalText:"",convertedText:null,searchedSimplified:!1};const{items:i,shopItems:a}=await q(),n=new Set;a.forEach(f=>{const l=f["0: Item"];l&&n.add(l)});const s=e.trim();let r=[],d=!1,b=s,o=null,c=!1;if(t===!0)return s.includes(" "),r=P(i,a,n,s,!0),{results:r,converted:!1,originalText:s,convertedText:null,searchedSimplified:!1};const p=s.includes(" ");if(r=P(i,a,n,s,!1),r.length===0&&p&&(r=P(i,a,n,s,!0)),r.length===0){let f;if(z(s)){const l=H(s);f=Q(l)}else f=Q(s);if(f!==s&&O(f)){d=!0,o=f;const l=f.includes(" ");r=P(i,a,n,f,!1),r.length===0&&l&&(r=P(i,a,n,f,!0))}}if(r.length===0){const f=z(s)?H(s):s;if(O(f)){const l=await te(f);l.length>0&&(c=!0,d||(d=!0,o=f),r=l.map(u=>i.find(m=>{const y=m["key: #"];return y&&parseInt(y,10)===u})).filter(u=>u!==void 0).map(u=>{const g=u["key: #"];let m=u["9: Name"]||"";(!m||m.trim()==="")&&(m=u["0: Singular"]||"");const y=u["11: Level{Item}"]||"",S=u["25: Price{Mid}"]||"",w=u["27: CanBeHq"]!=="False",T=n.has(g),E=x[g]?.tw||"",M=(u["22: IsUntradable"]||"").toString().trim(),_=!(M==="True"||M==="true"||M==="TRUE"||M==="1"),j=m.replace(/^["']|["']$/g,"").trim(),Y=E.replace(/^["']|["']$/g,"").trim();return{id:parseInt(g,10)||0,name:j,nameSimplified:j,itemLevel:y,shopPrice:S,description:Y,inShop:T,canBeHQ:w,isTradable:_}}).filter(u=>u.id>0).sort((u,g)=>{const m=(g.isTradable?1:0)-(u.isTradable?1:0);return m!==0?m:u.id-g.id}))}}return{results:r,converted:d,originalText:b,convertedText:o,searchedSimplified:c}}async function ue(e){if(!e||e<=0)return null;const{items:t,shopItems:i}=await q(),a=new Set;i.forEach(y=>{const S=y["0: Item"];S&&a.add(S)});const n=t.find(y=>{const S=y["key: #"];return S&&parseInt(S,10)===e});if(!n)return null;const s=n["key: #"];let r=n["9: Name"]||"";(!r||r.trim()==="")&&(r=n["0: Singular"]||"");const d=n["11: Level{Item}"]||"",b=n["25: Price{Mid}"]||"",o=n["27: CanBeHq"]!=="False",c=a.has(s),f=x[s]?.tw||"",l=(n["22: IsUntradable"]||"").toString().trim(),u=!(l==="True"||l==="true"||l==="TRUE"||l==="1"),g=r.replace(/^["']|["']$/g,"").trim(),m=f.replace(/^["']|["']$/g,"").trim();return{id:parseInt(s,10)||0,name:g,nameSimplified:g,itemLevel:d,shopPrice:b,description:m,inShop:c,canBeHQ:o,isTradable:u}}let v=null,I=null,U=!1;async function F(){if(v&&I)return{recipes:v,byResult:I};if(U){for(;U;)await new Promise(e=>setTimeout(e,100));return{recipes:v,byResult:I}}U=!0;try{return v=W,I=new Map,v.forEach(e=>{e.result&&(I.has(e.result)||I.set(e.result,[]),I.get(e.result).push(e))}),U=!1,{recipes:v,byResult:I}}catch(e){throw U=!1,console.error("Failed to load recipe database:",e),e}}async function re(e){if(!e||e<=0)return[];const{byResult:t}=await F();return t.get(e)||[]}async function de(e){if(!e||e<=0)return!1;const{byResult:t}=await F();return t.has(e)}const A=new Set([2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);async function se(e,t=1,i=new Set,a=0,n=!0){if(i.has(e)||a>10)return{itemId:e,amount:t,children:[],isCyclic:i.has(e),maxDepthReached:a>10};const s=await re(e);if(s.length===0)return{itemId:e,amount:t,children:[],isBaseMaterial:!0};const r=s[0],d=new Set(i);d.add(e);const b=r.yields||1,o=Math.ceil(t/b);let c=n?r.ingredients.filter(f=>!A.has(f.id)):r.ingredients;if(!n&&r.ingredients.length>0){const f=r.ingredients.filter(h=>!A.has(h.id)),l=r.ingredients.filter(h=>A.has(h.id));if(f.length>0&&l.length>0){const h=[],u=l.length,m=f.length-1,y=m>0?Math.floor(u/m):0,S=m>0?u%m:u;let w=0;for(let T=0;T<f.length;T++)if(h.push(f[T]),T<f.length-1){const k=y+(T<S?1:0);for(let E=0;E<k&&w<l.length;E++)h.push(l[w]),w++}for(;w<l.length;)h.push(l[w]),w++;c=h}else l.length>0&&f.length===0&&(c=l)}const p=await Promise.all(c.map(async f=>{const l=f.amount*o;return await se(f.id,l,d,a+1,n)}));return{itemId:e,amount:t,recipeId:r.id,job:r.job,level:r.lvl,yields:b,craftsNeeded:o,children:p,isBaseMaterial:!1}}async function me(e){if(!e||e<=0)return[];const{recipes:t}=await F(),i=new Set;return t.forEach(a=>{a.ingredients&&Array.isArray(a.ingredients)&&a.ingredients.some(s=>s.id===e)&&a.result&&i.add(a.result)}),Array.from(i)}export{ce as a,oe as b,O as c,se as d,me as f,ue as g,de as h,F as l,fe as s};
