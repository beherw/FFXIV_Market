import{C as H,a as O}from"./opencc-C1Qz6KEM.js";import{t as B,a as V,b as q}from"./teamcraft-data-u2h6--oi.js";const Q=H({from:"t",to:"cn"}),_=O({from:"cn",to:"t"});function x(e){if(!e)return e;try{return Q(e)}catch(n){return console.error("Error converting to Simplified Chinese:",n),e}}function Y(e){if(!e)return e;try{return _(e)}catch(n){return console.error("Error converting Simplified to Traditional:",n),e}}function z(e){return e?x(e)!==e:!1}function ee(e){return e?/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e):!1}let R=null,N=null,E=!1;const $=new Map;let L=null,D=!1,S=null;async function G(e=null){if(L)return L;if(D){for(;D;)await new Promise(n=>setTimeout(n,100));return L}D=!0;try{!e&&S&&S.abort();let n,s;e?s=e:(n=new AbortController,S=n,s=n.signal);const r=await fetch("https://raw.githubusercontent.com/thewakingsands/ffxiv-datamining-cn/master/Item.csv",{signal:s});if(!r.ok)throw new Error(`HTTP ${r.status}`);const t=await r.text(),o=t.indexOf(`
`),c=t.indexOf(`
`,o+1),h=t.indexOf(`
`,c+1),i=t.indexOf(`
`,h+1),a=t.slice(0,o).split(","),f=t.slice(o+1,c).split(",");return L=t.slice(i+1).split(`
`).filter(l=>l.trim()).map(l=>{const d=J(l),p={};return a.forEach((C,m)=>{if(m<f.length){const y=`${C}: ${f[m]}`;p[y]=m<d.length&&d[m]!==void 0?d[m]:""}}),p}).filter(l=>Object.keys(l).length>0),D=!1,e||(S=null),L}catch(n){if(D=!1,e||(S=null),n.name==="AbortError")return null;throw console.error("Failed to load Simplified Chinese item database:",n),n}}function J(e){const n=[];let s="",r=!1;for(let t=0;t<e.length;t++){const o=e[t];o==='"'?r=!r:o===","&&!r?(n.push(s),s=""):s+=o}return n.push(s),n.map(t=>t.trim())}async function te(e,n=null){if(!e||e<=0)return null;if($.has(e))return $.get(e);try{const s=await G(n);if(!s)return null;const r=s.find(c=>{const h=c["key: #"];return h&&parseInt(h,10)===e});if(!r)return null;let t=r["9: Name"]||"";if((!t||t.trim()==="")&&(t=r["0: Singular"]||""),!t||t.trim()==="")return null;const o=t.replace(/^["']|["']$/g,"").trim();return o&&$.set(e,o),o}catch(s){return s.name==="AbortError"||console.error(`Failed to get Simplified Chinese name for item ${e}:`,s),null}}function ne(){S&&(S.abort(),S=null,D=!1)}async function F(){if(R&&N)return{items:R,shopItems:N};if(E){for(;E;)await new Promise(e=>setTimeout(e,100));return{items:R,shopItems:N}}E=!0;try{return R=Object.entries(V).map(([n,s])=>{const r=s.tw||"";return{"key: #":n,"9: Name":r,"0: Singular":r,"11: Level{Item}":"","25: Price{Mid}":"","8: Description":"","22: IsUntradable":"False","27: CanBeHq":"True"}}).filter(n=>n["key: #"]&&n["9: Name"].trim()!==""),N=[],E=!1,{items:R,shopItems:N}}catch(e){throw E=!1,console.error("Failed to load item database:",e),e}}function A(e,n,s,r){const t=r.trim(),c=t.includes(" ")?t.split(/\s+/).filter(i=>i):[t];return e.filter(i=>{let a=i["9: Name"]||"";(!a||a.trim()==="")&&(a=i["0: Singular"]||"");const f=(i["22: IsUntradable"]||"").toString().trim(),T=f==="True"||f==="true"||f==="TRUE"||f==="1";i["key: #"];const u=a.includes("地图");if(!a||a.trim()===""||T)return!1;let l=a.replace(/^["']+|["']+$/g,"").trim();if(!l)return!1;const d=c.every(p=>l.includes(p));return d||u||l.includes("地圖"),d}).map(i=>{const a=i["key: #"];let f=i["9: Name"]||"";(!f||f.trim()==="")&&(f=i["0: Singular"]||"");const T=i["11: Level{Item}"]||"",u=i["25: Price{Mid}"]||"",l=i["27: CanBeHq"]!=="False",d=s.has(a),C=B[a]?.tw||"",m=(i["22: IsUntradable"]||"").toString().trim(),g=!(m==="True"||m==="true"||m==="TRUE"||m==="1"),b=f.replace(/^["']|["']$/g,"").trim(),I=C.replace(/^["']|["']$/g,"").trim();return{id:parseInt(a,10)||0,name:b,nameSimplified:b,itemLevel:T,shopPrice:u,description:I,inShop:d,canBeHQ:l,isTradable:g}}).filter(i=>i.id>0).sort((i,a)=>{const f=(a.isTradable?1:0)-(i.isTradable?1:0);return f!==0?f:i.id-a.id})}async function re(e){if(!e||e.trim()==="")return{results:[],converted:!1,originalText:"",convertedText:null};const{items:n,shopItems:s}=await F(),r=new Set;s.forEach(a=>{const f=a["0: Item"];f&&r.add(f)});const t=e.trim();let o=A(n,s,r,t),c=!1,h=t,i=null;if(o.length===0){const a=z(t)?x(t):Y(t);a!==t&&(c=!0,i=a,o=A(n,s,r,a))}return{results:o,converted:c,originalText:h,convertedText:i}}async function se(e){if(!e||e<=0)return null;const{items:n,shopItems:s}=await F(),r=new Set;s.forEach(y=>{const g=y["0: Item"];g&&r.add(g)});const t=n.find(y=>{const g=y["key: #"];return g&&parseInt(g,10)===e});if(!t)return null;const o=t["key: #"];let c=t["9: Name"]||"";(!c||c.trim()==="")&&(c=t["0: Singular"]||"");const h=t["11: Level{Item}"]||"",i=t["25: Price{Mid}"]||"",a=t["27: CanBeHq"]!=="False",f=r.has(o),u=B[o]?.tw||"",l=(t["22: IsUntradable"]||"").toString().trim(),p=!(l==="True"||l==="true"||l==="TRUE"||l==="1"),C=c.replace(/^["']|["']$/g,"").trim(),m=u.replace(/^["']|["']$/g,"").trim();return{id:parseInt(o,10)||0,name:C,nameSimplified:C,itemLevel:h,shopPrice:i,description:m,inShop:f,canBeHQ:a,isTradable:p}}let v=null,w=null,U=!1;async function M(){if(v&&w)return{recipes:v,byResult:w};if(U){for(;U;)await new Promise(e=>setTimeout(e,100));return{recipes:v,byResult:w}}U=!0;try{return v=q,w=new Map,v.forEach(e=>{e.result&&(w.has(e.result)||w.set(e.result,[]),w.get(e.result).push(e))}),U=!1,{recipes:v,byResult:w}}catch(e){throw U=!1,console.error("Failed to load recipe database:",e),e}}async function K(e){if(!e||e<=0)return[];const{byResult:n}=await M();return n.get(e)||[]}async function ie(e){if(!e||e<=0)return!1;const{byResult:n}=await M();return n.has(e)}const k=new Set([2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);async function W(e,n=1,s=new Set,r=0,t=!0){if(s.has(e)||r>10)return{itemId:e,amount:n,children:[],isCyclic:s.has(e),maxDepthReached:r>10};const o=await K(e);if(o.length===0)return{itemId:e,amount:n,children:[],isBaseMaterial:!0};const c=o[0],h=new Set(s);h.add(e);const i=c.yields||1,a=Math.ceil(n/i);let f=t?c.ingredients.filter(u=>!k.has(u.id)):c.ingredients;if(!t&&c.ingredients.length>0){const u=c.ingredients.filter(d=>!k.has(d.id)),l=c.ingredients.filter(d=>k.has(d.id));if(u.length>0&&l.length>0){const d=[],p=l.length,m=u.length-1,y=m>0?Math.floor(p/m):0,g=m>0?p%m:p;let b=0;for(let I=0;I<u.length;I++)if(d.push(u[I]),I<u.length-1){const j=y+(I<g?1:0);for(let P=0;P<j&&b<l.length;P++)d.push(l[b]),b++}for(;b<l.length;)d.push(l[b]),b++;f=d}else l.length>0&&u.length===0&&(f=l)}const T=await Promise.all(f.map(async u=>{const l=u.amount*a;return await W(u.id,l,h,r+1,t)}));return{itemId:e,amount:n,recipeId:c.id,job:c.job,level:c.lvl,yields:i,craftsNeeded:a,children:T,isBaseMaterial:!1}}async function ae(e){if(!e||e<=0)return[];const{recipes:n}=await M(),s=new Set;return n.forEach(r=>{r.ingredients&&Array.isArray(r.ingredients)&&r.ingredients.some(o=>o.id===e)&&r.result&&s.add(r.result)}),Array.from(s)}export{ne as a,te as b,ee as c,W as d,ae as f,se as g,ie as h,M as l,re as s};
