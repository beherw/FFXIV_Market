import{C as j,a as H}from"./opencc-C1Qz6KEM.js";import{t as B,a as O,b as V}from"./teamcraft-data-u2h6--oi.js";const q=j({from:"t",to:"cn"}),x=H({from:"cn",to:"t"});function Q(e){if(!e)return e;try{return q(e)}catch(t){return console.error("Error converting to Simplified Chinese:",t),e}}function _(e){if(!e)return e;try{return x(e)}catch(t){return console.error("Error converting Simplified to Traditional:",t),e}}function Y(e){return e?Q(e)!==e:!1}function Z(e){return e?/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e):!1}let R=null,N=null,E=!1;const k=new Map;let L=null,v=!1,C=null;async function z(e=null){if(L)return L;if(v){for(;v;)await new Promise(t=>setTimeout(t,100));return L}v=!0;try{!e&&C&&C.abort();let t,i;e?i=e:(t=new AbortController,C=t,i=t.signal);const r=await fetch("https://raw.githubusercontent.com/thewakingsands/ffxiv-datamining-cn/master/Item.csv",{signal:i});if(!r.ok)throw new Error(`HTTP ${r.status}`);const n=await r.text(),o=n.indexOf(`
`),c=n.indexOf(`
`,o+1),p=n.indexOf(`
`,c+1),I=n.indexOf(`
`,p+1),s=n.slice(0,o).split(","),a=n.slice(o+1,c).split(",");return L=n.slice(I+1).split(`
`).filter(l=>l.trim()).map(l=>{const f=G(l),h={};return s.forEach((b,m)=>{if(m<a.length){const g=`${b}: ${a[m]}`;h[g]=m<f.length&&f[m]!==void 0?f[m]:""}}),h}).filter(l=>Object.keys(l).length>0),v=!1,e||(C=null),L}catch(t){if(v=!1,e||(C=null),t.name==="AbortError")return null;throw console.error("Failed to load Simplified Chinese item database:",t),t}}function G(e){const t=[];let i="",r=!1;for(let n=0;n<e.length;n++){const o=e[n];o==='"'?r=!r:o===","&&!r?(t.push(i),i=""):i+=o}return t.push(i),t.map(n=>n.trim())}async function ee(e,t=null){if(!e||e<=0)return null;if(k.has(e))return k.get(e);try{const i=await z(t);if(!i)return null;const r=i.find(c=>{const p=c["key: #"];return p&&parseInt(p,10)===e});if(!r)return null;let n=r["9: Name"]||"";if((!n||n.trim()==="")&&(n=r["0: Singular"]||""),!n||n.trim()==="")return null;const o=n.replace(/^["']|["']$/g,"").trim();return o&&k.set(e,o),o}catch(i){return i.name==="AbortError"||console.error(`Failed to get Simplified Chinese name for item ${e}:`,i),null}}function te(){C&&(C.abort(),C=null,v=!1)}async function F(){if(R&&N)return{items:R,shopItems:N};if(E){for(;E;)await new Promise(e=>setTimeout(e,100));return{items:R,shopItems:N}}E=!0;try{return R=Object.entries(O).map(([t,i])=>{const r=i.tw||"";return{"key: #":t,"9: Name":r,"0: Singular":r,"11: Level{Item}":"","25: Price{Mid}":"","8: Description":"","22: IsUntradable":"False","27: CanBeHq":"True"}}).filter(t=>t["key: #"]&&t["9: Name"].trim()!==""),N=[],E=!1,{items:R,shopItems:N}}catch(e){throw E=!1,console.error("Failed to load item database:",e),e}}async function ne(e){if(!e||e.trim()==="")return[];const{items:t,shopItems:i}=await F(),r=e.trim(),n=Y(r)?r:_(r),c=n.includes(" ")?n.split(/\s+/).filter(s=>s):[n],p=new Set;return i.forEach(s=>{const a=s["0: Item"];a&&p.add(a)}),t.filter(s=>{let a=s["9: Name"]||"";(!a||a.trim()==="")&&(a=s["0: Singular"]||"");const d=(s["22: IsUntradable"]||"").toString().trim(),u=d==="True"||d==="true"||d==="TRUE"||d==="1";s["key: #"];const l=a.includes("地图");if(!a||a.trim()===""||u)return!1;let f=a.replace(/^["']+|["']+$/g,"").trim();if(!f)return!1;const h=c.every(b=>f.includes(b));return h||l||f.includes("地圖"),h}).map(s=>{const a=s["key: #"];let d=s["9: Name"]||"";(!d||d.trim()==="")&&(d=s["0: Singular"]||"");const u=s["11: Level{Item}"]||"",l=s["25: Price{Mid}"]||"",f=s["27: CanBeHq"]!=="False",h=p.has(a),m=B[a]?.tw||"",g=(s["22: IsUntradable"]||"").toString().trim(),w=!(g==="True"||g==="true"||g==="TRUE"||g==="1"),S=d.replace(/^["']|["']$/g,"").trim(),$=m.replace(/^["']|["']$/g,"").trim();return{id:parseInt(a,10)||0,name:S,nameSimplified:S,itemLevel:u,shopPrice:l,description:$,inShop:h,canBeHQ:f,isTradable:w}}).filter(s=>s.id>0).sort((s,a)=>{const d=(a.isTradable?1:0)-(s.isTradable?1:0);return d!==0?d:s.id-a.id})}async function re(e){if(!e||e<=0)return null;const{items:t,shopItems:i}=await F(),r=new Set;i.forEach(g=>{const y=g["0: Item"];y&&r.add(y)});const n=t.find(g=>{const y=g["key: #"];return y&&parseInt(y,10)===e});if(!n)return null;const o=n["key: #"];let c=n["9: Name"]||"";(!c||c.trim()==="")&&(c=n["0: Singular"]||"");const p=n["11: Level{Item}"]||"",I=n["25: Price{Mid}"]||"",s=n["27: CanBeHq"]!=="False",a=r.has(o),u=B[o]?.tw||"",l=(n["22: IsUntradable"]||"").toString().trim(),h=!(l==="True"||l==="true"||l==="TRUE"||l==="1"),b=c.replace(/^["']|["']$/g,"").trim(),m=u.replace(/^["']|["']$/g,"").trim();return{id:parseInt(o,10)||0,name:b,nameSimplified:b,itemLevel:p,shopPrice:I,description:m,inShop:a,canBeHQ:s,isTradable:h}}let D=null,T=null,U=!1;async function P(){if(D&&T)return{recipes:D,byResult:T};if(U){for(;U;)await new Promise(e=>setTimeout(e,100));return{recipes:D,byResult:T}}U=!0;try{return D=V,T=new Map,D.forEach(e=>{e.result&&(T.has(e.result)||T.set(e.result,[]),T.get(e.result).push(e))}),U=!1,{recipes:D,byResult:T}}catch(e){throw U=!1,console.error("Failed to load recipe database:",e),e}}async function J(e){if(!e||e<=0)return[];const{byResult:t}=await P();return t.get(e)||[]}async function se(e){if(!e||e<=0)return!1;const{byResult:t}=await P();return t.has(e)}const M=new Set([2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);async function K(e,t=1,i=new Set,r=0,n=!0){if(i.has(e)||r>10)return{itemId:e,amount:t,children:[],isCyclic:i.has(e),maxDepthReached:r>10};const o=await J(e);if(o.length===0)return{itemId:e,amount:t,children:[],isBaseMaterial:!0};const c=o[0],p=new Set(i);p.add(e);const I=c.yields||1,s=Math.ceil(t/I);let a=n?c.ingredients.filter(u=>!M.has(u.id)):c.ingredients;if(!n&&c.ingredients.length>0){const u=c.ingredients.filter(f=>!M.has(f.id)),l=c.ingredients.filter(f=>M.has(f.id));if(u.length>0&&l.length>0){const f=[],h=l.length,m=u.length-1,g=m>0?Math.floor(h/m):0,y=m>0?h%m:h;let w=0;for(let S=0;S<u.length;S++)if(f.push(u[S]),S<u.length-1){const $=g+(S<y?1:0);for(let A=0;A<$&&w<l.length;A++)f.push(l[w]),w++}for(;w<l.length;)f.push(l[w]),w++;a=f}else l.length>0&&u.length===0&&(a=l)}const d=await Promise.all(a.map(async u=>{const l=u.amount*s;return await K(u.id,l,p,r+1,n)}));return{itemId:e,amount:t,recipeId:c.id,job:c.job,level:c.lvl,yields:I,craftsNeeded:s,children:d,isBaseMaterial:!1}}async function ie(e){if(!e||e<=0)return[];const{recipes:t}=await P(),i=new Set;return t.forEach(r=>{r.ingredients&&Array.isArray(r.ingredients)&&r.ingredients.some(o=>o.id===e)&&r.result&&i.add(r.result)}),Array.from(i)}export{te as a,ee as b,Z as c,K as d,ie as f,re as g,se as h,P as l,ne as s};
