import{_ as qe,g as Je,T as Xe,a as Ye,S as Ze,I as et}from"./index-iOCQ-933.js";import{u as tt,b as st,a as rt,r as s,j as t}from"./react-vendor-DmEpS5Kz.js";import{g as at,b as nt}from"./services-data-rxdqLngZ.js";import{a as it}from"./axios-B9ygI19o.js";import"./vendor-dPMYpV4t.js";import"./opencc-C1Qz6KEM.js";import"./teamcraft-data-u2h6--oi.js";const ae={1:{MainHand:1,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},2:{MainHand:0,OffHand:1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},3:{MainHand:0,OffHand:0,Head:1,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},4:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},5:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:1,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},6:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:1,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},7:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},8:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},9:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:1,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},10:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:1,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},11:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:1,FingerL:0,FingerR:0,SoulCrystal:0},12:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:1,FingerR:1,SoulCrystal:0},13:{MainHand:1,OffHand:-1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},14:{MainHand:1,OffHand:1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},15:{MainHand:0,OffHand:0,Head:-1,Body:1,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},16:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},17:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:1},18:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},19:{MainHand:0,OffHand:0,Head:-1,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},20:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},21:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},22:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},23:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:-1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},24:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0}},lt={MainHand:"主手武器",OffHand:"副手",Head:"頭部",Body:"身體",Gloves:"手套",Waist:"腰部",Legs:"腿部",Feet:"腳部",Ears:"耳環",Neck:"項鍊",Wrists:"手環",Rings:"戒指"};function vt({addToast:x,removeToast:ke,toasts:We,datacenters:Ee,worlds:ne,selectedWorld:v,onWorldChange:Pe,selectedServerOption:g,onServerOptionChange:we,serverOptions:Ie,isServerDataLoaded:W,onItemSelect:Q,onSearch:je,searchText:Me,setSearchText:ie,isSearching:E}){const K=tt(),[F,Be]=st(),M=rt(),[m,le]=s.useState(""),[y,P]=s.useState(null),w=s.useRef(null),B=s.useRef(!1),J=s.useRef(""),[H,O]=s.useState(null),[X,Y]=s.useState([]),[Oe,oe]=s.useState({}),[Ge,ce]=s.useState({}),[_e,de]=s.useState({}),[Ve,ue]=s.useState({}),[$e,fe]=s.useState({}),[ge,G]=s.useState(!1),[Ae,De]=s.useState(null),_=s.useRef(null),V=s.useRef(null),me=s.useCallback(async()=>{if(V.current)return V.current;const e=await qe(()=>import("./equipment-sIOEhpr0.js"),[]);return V.current=e.default,V.current},[]),L=s.useCallback(async()=>{if(_.current)return _.current;const e=await qe(()=>import("./ilvls-Bj6OKdVo.js"),[]);return _.current=e.default,_.current},[]);s.useEffect(()=>{if(B.current)return;const e=`${M.pathname}?${M.search}`;if(J.current===e)return;const n=F.get("ilvl"),c=F.get("category");if(n){const o=parseInt(n,10);!isNaN(o)&&o>=1&&o<=999&&(B.current=!0,le(n),L().then(r=>{const a=Object.entries(r).filter(([u,A])=>A===o);a.length>0&&P({valid:!0,message:`找到 ${a.length} 個物品`})}),O(c||null),J.current=e)}else J.current=e},[M.pathname,M.search,F,L]);const[ve,pe]=s.useState(!1),$=s.useRef(null);s.useEffect(()=>{const e=F.get("ilvl");e&&B.current&&m===e&&y?.valid&&W&&(B.current=!1,pe(!0))},[m,y,F,W]),s.useEffect(()=>{ve&&m&&y?.valid&&W&&$.current&&(pe(!1),setTimeout(()=>{$.current&&$.current()},100))},[ve,m,y,W]);const Z=s.useMemo(()=>{const e=new Map;Object.entries(ae).forEach(([c,o])=>{Object.entries(o).forEach(([r,a])=>{if(r!=="SoulCrystal"&&(a===1||a===-1)){const u=r==="FingerL"||r==="FingerR"?"Rings":r;e.has(u)||e.set(u,{name:u,translatedName:lt[u]||u})}})});const n=["MainHand","OffHand","Head","Body","Gloves","Legs","Feet","Ears","Neck","Wrists","Rings"];return Array.from(e.values()).sort((c,o)=>{const r=n.indexOf(c.name),a=n.indexOf(o.name);return r===-1?1:a===-1?-1:r-a})},[]),he=s.useCallback((e,n,c)=>{if(!n)return!0;const o=c[e.toString()];if(!o||o.equipSlotCategory===void 0)return!1;const r=o.equipSlotCategory,a=ae[r.toString()];return a?n==="Rings"?a.FingerL===1||a.FingerL===-1||a.FingerR===1||a.FingerR===-1:n==="SoulCrystal"?!1:a[n]===1||a[n]===-1:!1},[]),xe=s.useCallback((e,n)=>{const c=n[e.toString()];if(!c||c.equipSlotCategory===void 0)return!1;const o=c.equipSlotCategory,r=ae[o.toString()];return r?Z.some(a=>a.name==="Rings"?r.FingerL===1||r.FingerL===-1||r.FingerR===1||r.FingerR===-1:a.name==="SoulCrystal"?!1:r[a.name]===1||r[a.name]===-1):!1},[Z]),Te=s.useCallback(e=>{le(e),w.current&&clearTimeout(w.current),w.current=setTimeout(async()=>{const n=parseInt(e,10);if(e===""){P(null);return}if(isNaN(n)||n<1||n>999){P({valid:!1,message:"請輸入1-999之間的數字"});return}const c=await L(),o=Object.entries(c).filter(([r,a])=>a===n);o.length===0?P({valid:!1,message:"此物品等級沒有物品"}):P({valid:!0,message:`找到 ${o.length} 個物品`})},1e3)},[L]);s.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const ee=s.useCallback(async()=>{if(E)return;const e=parseInt(m,10);if(isNaN(e)||e<1||e>999){x("請輸入有效的物品等級","error");return}const n=F.get("ilvl"),c=F.get("category");if(n!==m||c!==(H||"")){const r=new URLSearchParams;r.set("ilvl",m),H?r.set("category",H):r.delete("category"),K(`/msq-price-checker?${r.toString()}`,{replace:!0})}Y([]),oe({}),ce({}),de({}),ue({}),fe({});try{const[r,a]=await Promise.all([L(),me()]);let u=Object.entries(r).filter(([i,f])=>f===e).map(([i,f])=>parseInt(i,10));if(u.length===0){x("未找到該物品等級的物品","warning"),Y([]);return}if(H?u=u.filter(i=>he(i,H,a)):u=u.filter(i=>xe(i,a)),u.length===0){x("該裝備分類中沒有相符的物品","warning");return}const A=await Je();De(A);const D=u.filter(i=>A.has(i));if(D.length===0){x("沒有可交易的物品","warning");return}const Ue=D.map(i=>at(i)),ye=(await Promise.all(Ue)).filter(i=>i!==null);if(ye.length===0){x("無法獲取物品信息","error");return}const ze=ye.map(i=>{const f=a[i.id.toString()];return{...i,ilvl品級:e,需求等級:f?.level||0,equipSlotCategory:f?.equipSlotCategory,jobs:f?.jobs||[]}}).sort((i,f)=>i.需求等級!==f.需求等級?i.需求等級-f.需求等級:i.name.localeCompare(f.name));if(Y(ze),G(!0),!v||!g){x("請選擇伺服器","warning"),G(!1);return}const I=g===v.section,Qe=I?v.section:g,be=100,Fe={},He={},Le={},Ne={},N={};for(let i=0;i<D.length;i+=be){const f=D.slice(i,i+be),Ke=f.join(",");try{const S=(await it.get(`https://universalis.app/api/v2/aggregated/${encodeURIComponent(Qe)}/${Ke}`)).data;S&&S.results&&S.results.forEach(l=>{const j=l.itemId,T=(p,h,d)=>{const b=p?.world?.[d],re=h?.world?.[d],Re=p?.dc?.[d],Ce=h?.dc?.[d],q=I?Re!==void 0?Re:b:b!==void 0?b:void 0,k=I?Ce!==void 0?Ce:re:re!==void 0?re:void 0;if(d==="quantity"){if(q!==void 0||k!==void 0)return(q||0)+(k||0)}else{if(q!==void 0&&k!==void 0)return Math.min(q,k);if(k!==void 0)return k;if(q!==void 0)return q}return null},te=T(l.nq?.dailySaleVelocity,l.hq?.dailySaleVelocity,"quantity"),se=T(l.nq?.averageSalePrice,l.hq?.averageSalePrice,"price"),U=T(l.nq?.minListing,l.hq?.minListing,"price"),z=T(l.nq?.recentPurchase,l.hq?.recentPurchase,"price");let R=null;if(U!=null)if(I)R=U;else{const p=l.nq?.minListing?.world?.price,h=l.hq?.minListing?.world?.price;let d=null;p!==void 0&&h!==void 0?d=h<=p?l.hq?.minListing?.world:l.nq?.minListing?.world:h!==void 0?d=l.hq?.minListing?.world:p!==void 0&&(d=l.nq?.minListing?.world);const b=d?.region;R={price:U},b!==void 0&&(R.region=b)}let C=null;if(z!=null)if(I)C=z;else{const p=l.nq?.recentPurchase?.world?.price,h=l.hq?.recentPurchase?.world?.price;let d=null;p!==void 0&&h!==void 0?d=h<=p?l.hq?.recentPurchase?.world:l.nq?.recentPurchase?.world:h!==void 0?d=l.hq?.recentPurchase?.world:p!==void 0&&(d=l.nq?.recentPurchase?.world);const b=d?.region;C={price:z},b!==void 0&&(C.region=b)}te!=null&&(Fe[j]=te),se!=null&&(He[j]=Math.round(se)),R!=null&&(Le[j]=R),C!=null&&(Ne[j]=C),N[j]=!0}),f.forEach(l=>{N.hasOwnProperty(l)||(N[l]=!1)})}catch(Se){console.error("Error fetching market data:",Se),f.forEach(S=>{N.hasOwnProperty(S)||(N[S]=!1)})}}oe(Fe),ce(He),de(Le),ue(Ne),fe(N),G(!1)}catch(r){console.error("Search error:",r),x("搜索失敗，請稍後再試","error"),G(!1)}},[m,H,v,g,x,he,xe,F,Be,L,me]);return s.useEffect(()=>{$.current=ee},[ee]),t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white",children:[t.jsx(Xe,{onSearch:je,isSearching:E,searchText:Me,setSearchText:ie,isServerDataLoaded:W,selectedDcName:v?.section,onItemSelect:Q,showNavigationButtons:!0,activePage:"msq-price-checker",onMSQPriceCheckerClick:()=>{ie(""),K("/msq-price-checker")}}),t.jsx("div",{className:"fixed right-2 mid:right-4 left-2 mid:left-auto z-50 space-y-2 max-w-sm mid:max-w-none top-[60px] mid:top-4",children:We.map(e=>t.jsx(Ye,{message:e.message,type:e.type,onClose:()=>ke(e.id)},e.id))}),t.jsx("div",{className:"pt-24 pb-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-ffxiv-gold mb-2",children:"主線裝備查價"}),t.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"主線拿到的箱子可以快速查看市場價格。"})]}),t.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4 sm:p-6 mb-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"物品等級 (ilvl品級)"}),t.jsx("div",{className:"flex items-end gap-3",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{type:"number",inputMode:"numeric",value:m,onChange:e=>Te(e.target.value),placeholder:"輸入物品等級...",className:"w-full px-3 py-2 bg-slate-900/50 border border-purple-500/30 rounded-lg text-white focus:outline-none focus:border-ffxiv-gold",min:"1",max:"999"}),y&&t.jsx("div",{className:`mt-2 text-xs ${y.valid?"text-green-400":"text-yellow-400"}`,children:y.message})]})})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"裝備分類 (可選)"}),t.jsxs("div",{className:"flex flex-wrap gap-2 max-h-48 overflow-y-auto p-2 bg-slate-900/30 rounded-lg border border-purple-500/20",children:[t.jsx("button",{onClick:()=>O(null),className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all ${H===null?"bg-ffxiv-gold text-slate-900 border-2 border-ffxiv-gold":"bg-slate-800/50 text-gray-300 border border-purple-500/30 hover:bg-purple-800/40 hover:border-purple-400/50"}`,children:"全部分類"}),Z.map(e=>{const n=H===e.name;return t.jsx("button",{onClick:()=>O(e.name),className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all ${n?"bg-ffxiv-gold text-slate-900 border-2 border-ffxiv-gold":"bg-slate-800/50 text-gray-300 border border-purple-500/30 hover:bg-purple-800/40 hover:border-purple-400/50"}`,children:e.translatedName},e.name)})]})]}),v&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"伺服器選擇"}),t.jsx(Ze,{datacenters:Ee,worlds:ne,selectedWorld:v,onWorldChange:Pe,selectedServerOption:g,onServerOptionChange:we,serverOptions:Ie,disabled:ge})]}),t.jsx("button",{onClick:ee,disabled:E||!m||!y?.valid,className:`w-full py-3 rounded-lg font-semibold transition-all ${E||!m||!y?.valid?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-gradient-to-r from-ffxiv-gold to-yellow-500 text-slate-900 hover:shadow-[0_0_20px_rgba(212,175,55,0.5)]"}`,children:E?"搜索中...":"搜索"})]}),X.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-ffxiv-gold",children:["搜索結果 (",X.length," 個物品)"]}),v&&g&&t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border border-purple-500/30 rounded-lg backdrop-blur-sm",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-ffxiv-gold animate-pulse"}),t.jsx("span",{className:"text-xs sm:text-sm font-semibold text-ffxiv-gold",children:g===v.section?`${v.section} (全服)`:ne[g]||`伺服器 ${g}`})]})]}),t.jsx(et,{items:X,onSelect:e=>{if(Q){const n=new URLSearchParams;g&&n.set("server",g);const c=n.toString(),o=`/item/${e.id}${c?"?"+c:""}`;Q(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>{K(o,{replace:!0})})})}},selectedItem:null,marketableItems:Ae,itemVelocities:Oe,itemAveragePrices:Ge,itemMinListings:_e,itemRecentPurchases:Ve,itemTradability:$e,isLoadingVelocities:ge,averagePriceHeader:"平均價格",getSimplifiedChineseName:nt,addToast:x})]})]})})]})}export{vt as default};
