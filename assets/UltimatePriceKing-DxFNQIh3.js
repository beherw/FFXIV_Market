import{u as Be,r,j as t}from"./react-vendor-DmEpS5Kz.js";import{g as ie,T as ze,a as Ue,S as He,I as Qe}from"./index-BfixPHg9.js";import{l as Te,g as Fe,b as Ge}from"./services-data-rxdqLngZ.js";import{g as Ke}from"./internalUrl-DfDVcRif.js";import{a as Xe}from"./axios-B9ygI19o.js";import"./vendor-dPMYpV4t.js";import"./opencc-C1Qz6KEM.js";import"./teamcraft-data-u2h6--oi.js";const Ye={1:{tw:"åŠè¡“å£«"},2:{tw:"æ ¼é¬¥å£«"},3:{tw:"æ–§è¡“å£«"},4:{tw:"æ§è¡“å£«"},5:{tw:"å¼“è¡“å£«"},6:{tw:"å¹»è¡“å£«"},7:{tw:"å’’è¡“å£«"},8:{tw:"æœ¨å·¥å¸«"},9:{tw:"é›é€ å¸«"},10:{tw:"ç”²å†‘å¸«"},11:{tw:"é‡‘å·¥å¸«"},12:{tw:"çš®é©å¸«"},13:{tw:"è£ç¸«å¸«"},14:{tw:"éŠé‡‘è¡“å¸«"},15:{tw:"çƒ¹èª¿å¸«"},16:{tw:"æ¡æ˜å¸«"},17:{tw:"åœ’è—å¸«"},18:{tw:"æ¼å¸«"},19:{tw:"é¨å£«"},20:{tw:"æ­¦åƒ§"},21:{tw:"æˆ°å£«"},22:{tw:"é¾é¨å£«"},23:{tw:"åŸéŠè©©äºº"},24:{tw:"ç™½é­”é“å£«"},25:{tw:"é»‘é­”é“å£«"},26:{tw:"å·´è¡“å£«"},27:{tw:"å¬å–šå£«"},28:{tw:"å­¸è€…"},29:{tw:"é›™åŠå£«"},30:{tw:"å¿è€…"},31:{tw:"æ©Ÿå·¥å£«"},32:{tw:"æš—é»‘é¨å£«"},33:{tw:"å æ˜Ÿè¡“å¸«"},34:{tw:"æ­¦å£«"},35:{tw:"èµ¤é­”é“å£«"},36:{tw:"é’é­”é“å£«"},37:{tw:"çµ•æ§æˆ°å£«"},38:{tw:"èˆè€…"},39:{tw:"å¥ªé­‚è€…"},40:{tw:"è³¢è€…"},41:{tw:"æ¯’è›‡åŠå£«"},42:{tw:"ç¹ªéˆæ³•å¸«"}};function lt({addToast:u,removeToast:ce,toasts:oe,datacenters:ue,worlds:T,selectedWorld:m,onWorldChange:de,selectedServerOption:x,onServerOptionChange:ge,serverOptions:me,onSearch:xe,searchText:fe,setSearchText:he,isSearching:pe,isServerDataLoaded:be,onItemSelect:we}){Be();const[d,ve]=r.useState(1),[c,Ne]=r.useState(11),[ye,V]=r.useState("1"),[je,C]=r.useState("11"),[i,Pe]=r.useState([]),I=r.useRef(null),[A,F]=r.useState([]),[q,b]=r.useState(!1),[Ie,G]=r.useState({}),[qe,K]=r.useState({}),[Me,X]=r.useState({}),[Se,Y]=r.useState({}),[ke,Z]=r.useState({}),[Re,E]=r.useState(!1),[$e,Ve]=r.useState(null);r.useEffect(()=>{ie().then(e=>{Ve(e)})},[]);const h=r.useCallback(e=>e===0?10:e===1?50:e===2?30:e===3?20:10,[]),M=r.useMemo(()=>{const e=h(i.length),n=c-d;return n>=0&&n<=e+1&&d>=1&&c<=999},[d,c,i.length,h]),O=r.useMemo(()=>{const e=h(i.length);if(c-d<=e+1)return{suggestedMin:d,suggestedMax:c};const l=c-e-1;return l>=1?{suggestedMin:l,suggestedMax:c}:{suggestedMin:1,suggestedMax:1+e+1}},[d,c,i.length,h]),W=r.useCallback((e,n)=>{(n===""||/^\d*$/.test(n))&&(e==="min"?V(n):C(n),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{const l=parseInt(n,10);if(isNaN(l)||l<1||l>999){e==="min"?V(d.toString()):C(c.toString());return}let g=d,o=c;if(e==="min"?g=l:o=l,g<1&&(g=1,V("1")),o>999&&(o=999,C("999")),g>o){const _=g;g=o,o=_,V(g.toString()),C(o.toString())}ve(g),Ne(o)},1300))},[d,c]);r.useEffect(()=>()=>{I.current&&clearTimeout(I.current)},[]);const Ce=r.useCallback(e=>{const n=parseInt(e,10);Pe(l=>l.includes(n)?l.filter(g=>g!==n):l.length>=4?(Promise.resolve().then(()=>{u("æœ€å¤šåªèƒ½é¸æ“‡4å€‹è·æ¥­","warning")}),l):[...l,n])},[u]),Ee=r.useCallback(async()=>{if(!q){if(!M){u(`ç¯„åœéå¤§ï¼æœ€å¤šåªèƒ½æœç´¢ ${h(i.length)} å€‹ç­‰ç´šç¯„åœ`,"error");return}b(!0),F([]),G({}),K({}),X({}),Y({}),Z({});try{const{recipes:e}=await Te();let n=e;i.length>0&&(n=n.filter(a=>i.includes(a.job))),n=n.filter(a=>a.lvl>=d&&a.lvl<=c);const l=[...new Set(n.map(a=>a.result))];if(l.length===0){u("æœªæ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„é…æ–¹","warning"),b(!1);return}u(`æ‰¾åˆ° ${l.length} å€‹ç‰©å“ï¼Œæ­£åœ¨éæ¿¾å¯äº¤æ˜“ç‰©å“...`,"info");const g=await ie(),o=l.filter(a=>g.has(a));if(o.length===0){u("æ²’æœ‰å¯äº¤æ˜“çš„ç‰©å“","warning"),b(!1);return}u(`æ‰¾åˆ° ${o.length} å€‹å¯äº¤æ˜“ç‰©å“ï¼Œæ­£åœ¨ç²å–å¸‚å ´æ•¸æ“š...`,"info");const _=o.map(a=>Fe(a)),B=(await Promise.all(_)).filter(a=>a!==null);if(B.length===0){u("ç„¡æ³•ç²å–ç‰©å“ä¿¡æ¯","error"),b(!1);return}if(F(B),E(!0),!m||!x){u("è«‹é¸æ“‡ä¼ºæœå™¨","warning"),E(!1),b(!1);return}const ee=x===m.section,Ae=ee?m.section:x,te=100,se={},ne={},re={},le={},w={};for(let a=0;a<o.length;a+=te){const z=o.slice(a,a+te),_e=z.join(",");try{const v=(await Xe.get(`https://universalis.app/api/v2/aggregated/${encodeURIComponent(Ae)}/${_e}`)).data;v&&v.results&&v.results.forEach(s=>{const S=s.itemId,L=(k,R,p)=>{const J=k?.world?.[p],y=R?.world?.[p],$=k?.dc?.[p],j=R?.dc?.[p],f=J!==void 0?J:$,P=y!==void 0?y:j;if(p==="quantity"){if(f!==void 0||P!==void 0)return(f||0)+(P||0)}else{if(f!==void 0&&P!==void 0)return Math.min(f,P);if(P!==void 0)return P;if(f!==void 0)return f}return null},U=L(s.nq?.dailySaleVelocity,s.hq?.dailySaleVelocity,"quantity"),H=L(s.nq?.averageSalePrice,s.hq?.averageSalePrice,"price"),Q=L(s.nq?.minListing,s.hq?.minListing,"price"),D=L(s.nq?.recentPurchase,s.hq?.recentPurchase,"price");let N=null;if(D!=null)if(ee)N=D;else{const k=s.nq?.recentPurchase?.world?.price,R=s.hq?.recentPurchase?.world?.price,p=s.nq?.recentPurchase?.dc?.price,J=s.hq?.recentPurchase?.dc?.price,y=k!==void 0?k:p,$=R!==void 0?R:J;let j=null;y!==void 0&&$!==void 0?j=$<=y?s.hq?.recentPurchase?.world||s.hq?.recentPurchase?.dc:s.nq?.recentPurchase?.world||s.nq?.recentPurchase?.dc:$!==void 0?j=s.hq?.recentPurchase?.world||s.hq?.recentPurchase?.dc:y!==void 0&&(j=s.nq?.recentPurchase?.world||s.nq?.recentPurchase?.dc);const f=j?.region;N={price:D},f!==void 0&&(N.region=f)}U!=null&&(se[S]=U),H!=null&&(ne[S]=Math.round(H)),Q!=null&&(re[S]=Q),N!=null&&(le[S]=N),w[S]=!0}),z.forEach(s=>{w.hasOwnProperty(s)||(w[s]=!1)})}catch(ae){console.error("Error fetching market data:",ae),z.forEach(v=>{w.hasOwnProperty(v)||(w[v]=!1)})}}G(se),K(ne),X(re),Y(le),Z(w),E(!1),u(`æœç´¢å®Œæˆï¼æ‰¾åˆ° ${B.length} å€‹å¯äº¤æ˜“ç‰©å“`,"success")}catch(e){console.error("Search error:",e),u("æœç´¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦","error"),E(!1)}finally{b(!1)}}},[d,c,i,q,M,h,u,m,x]),Le={8:"ğŸ”¨",9:"âš’ï¸",10:"ğŸ›¡ï¸",11:"ğŸ’",12:"ğŸ§µ",13:"ğŸ§¶",14:"âš—ï¸",15:"ğŸ³"},De=Object.entries(Ye).map(([e,n])=>({id:parseInt(e,10),name:n.tw,icon:Le[parseInt(e,10)]||"âš™ï¸"})).filter(e=>e.id>=8&&e.id<=15),Je=h(i.length);return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white",children:[t.jsx(ze,{onSearch:xe,isSearching:pe,searchText:fe,setSearchText:he,isServerDataLoaded:be,selectedDcName:m?.section,onItemSelect:we,showNavigationButtons:!0,activePage:"ultimate-price-king"}),t.jsx("div",{className:"fixed right-2 mid:right-4 left-2 mid:left-auto z-50 space-y-2 max-w-sm mid:max-w-none top-[60px] mid:top-4",children:oe.map(e=>t.jsx(Ue,{message:e.message,type:e.type,onClose:()=>ce(e.id)},e.id))}),t.jsx("div",{className:"pt-24 pb-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-ffxiv-gold mb-2",children:"è£½é€ è·æ‰¾åƒ¹"}),t.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"ç”¨ä¾†æ ¹æ“šè£½ä½œè·æ¥­æŸ¥æ‰¾ç‰©åƒ¹è‚¥ç¾çš„ç‰©å“ï¼ŒæŒæ§å¸‚å ´é›·é›»ã€‚"})]}),t.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4 sm:p-6 mb-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"ç‰©å“ç­‰ç´šç¯„åœ (1-999)"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"æœ€å°ç­‰ç´š"}),t.jsx("input",{type:"text",inputMode:"numeric",value:ye,onChange:e=>W("min",e.target.value),className:"w-full px-3 py-2 bg-slate-900/50 border border-purple-500/30 rounded-lg text-white focus:outline-none focus:border-ffxiv-gold"})]}),t.jsx("div",{className:"pt-6 text-gray-400",children:"-"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"æœ€å¤§ç­‰ç´š"}),t.jsx("input",{type:"text",inputMode:"numeric",value:je,onChange:e=>W("max",e.target.value),className:"w-full px-3 py-2 bg-slate-900/50 border border-purple-500/30 rounded-lg text-white focus:outline-none focus:border-ffxiv-gold"})]})]}),t.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["ç•¶å‰ç¯„åœ: ",c-d+1," å€‹ç­‰ç´š",i.length>0&&t.jsxs("span",{className:"ml-2 text-ffxiv-gold",children:["(å·²é¸æ“‡ ",i.length," å€‹è·æ¥­ï¼Œæœ€å¤§ç¯„åœ: ",Je,")"]})]}),!M&&t.jsxs("div",{className:"mt-2 text-xs text-yellow-400",children:["ç¯„åœéå¤§ï¼å»ºè­°èª¿æ•´ç‚º: ",O.suggestedMin,"-",O.suggestedMax]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"è·æ¥­é¸æ“‡ (æœ€å¤š4å€‹)"}),t.jsx("div",{className:"flex flex-wrap gap-2 max-h-48 overflow-y-auto p-2 bg-slate-900/30 rounded-lg border border-purple-500/20",children:De.map(e=>{const n=i.includes(e.id);return t.jsxs("button",{onClick:()=>Ce(e.id),className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all flex items-center gap-1.5 ${n?"bg-ffxiv-gold text-slate-900 border-2 border-ffxiv-gold":"bg-slate-800/50 text-gray-300 border border-purple-500/30 hover:bg-purple-800/40 hover:border-purple-400/50"}`,children:[t.jsx("span",{className:"text-base",children:e.icon}),t.jsx("span",{children:e.name})]},e.id)})}),t.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["å·²é¸æ“‡: ",i.length,"/4",i.length===0&&t.jsx("span",{className:"ml-2 text-yellow-400",children:"æœªé¸æ“‡è·æ¥­æ™‚ï¼Œç¯„åœé™åˆ¶ç‚º10å€‹ç­‰ç´š"})]})]}),m&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"ä¼ºæœå™¨é¸æ“‡"}),t.jsx(He,{datacenters:ue,worlds:T,selectedWorld:m,onWorldChange:de,selectedServerOption:x,onServerOptionChange:ge,serverOptions:me})]}),t.jsx("button",{onClick:Ee,disabled:q||!M||i.length===0,className:`w-full py-3 rounded-lg font-semibold transition-all ${q||!M||i.length===0?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-gradient-to-r from-ffxiv-gold to-yellow-500 text-slate-900 hover:shadow-[0_0_20px_rgba(212,175,55,0.5)]"}`,children:q?"æœç´¢ä¸­...":"æœç´¢"})]}),A.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-ffxiv-gold",children:["æœç´¢çµæœ (",A.length," å€‹ç‰©å“)"]}),m&&x&&t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border border-purple-500/30 rounded-lg backdrop-blur-sm",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-ffxiv-gold animate-pulse"}),t.jsx("span",{className:"text-xs sm:text-sm font-semibold text-ffxiv-gold",children:x===m.section?`${m.section} (å…¨æœ)`:T[x]||`ä¼ºæœå™¨ ${x}`})]})]}),t.jsx(Qe,{items:A,onSelect:e=>{window.open(`${window.location.origin}${Ke(`/item/${e.id}`)}`,"_blank","noopener,noreferrer")},selectedItem:null,marketableItems:$e,itemVelocities:Ie,itemAveragePrices:qe,itemMinListings:Me,itemRecentPurchases:Se,itemTradability:ke,isLoadingVelocities:Re,averagePriceHeader:"å¹³å‡åƒ¹æ ¼",getSimplifiedChineseName:Ge,addToast:u})]})]})})]})}export{lt as default};
