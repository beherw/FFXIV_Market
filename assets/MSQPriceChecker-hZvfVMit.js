import{_ as Re,g as Je,T as Xe,a as Ye,S as Ze,I as es}from"./index-BfixPHg9.js";import{u as ss,b as ts,a as rs,r,j as t}from"./react-vendor-DmEpS5Kz.js";import{g as ns,b as as}from"./services-data-rxdqLngZ.js";import{a as is}from"./axios-B9ygI19o.js";import"./vendor-dPMYpV4t.js";import"./opencc-C1Qz6KEM.js";import"./teamcraft-data-u2h6--oi.js";const ie={1:{MainHand:1,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},2:{MainHand:0,OffHand:1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},3:{MainHand:0,OffHand:0,Head:1,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},4:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},5:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:1,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},6:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:1,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},7:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},8:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},9:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:1,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},10:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:1,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},11:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:1,FingerL:0,FingerR:0,SoulCrystal:0},12:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:1,FingerR:1,SoulCrystal:0},13:{MainHand:1,OffHand:-1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},14:{MainHand:1,OffHand:1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},15:{MainHand:0,OffHand:0,Head:-1,Body:1,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},16:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},17:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:1},18:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},19:{MainHand:0,OffHand:0,Head:-1,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},20:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},21:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},22:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},23:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:-1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},24:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0}},ls={MainHand:"主手武器",OffHand:"副手",Head:"頭部",Body:"身體",Gloves:"手套",Waist:"腰部",Legs:"腿部",Feet:"腳部",Ears:"耳環",Neck:"項鍊",Wrists:"手環",Rings:"戒指"};function hs({addToast:x,removeToast:Ce,toasts:ke,datacenters:We,worlds:le,selectedWorld:p,onWorldChange:Ee,selectedServerOption:f,onServerOptionChange:we,serverOptions:Ie,isServerDataLoaded:w,onItemSelect:J,onSearch:je,searchText:Me,setSearchText:oe,isSearching:I}){const X=ss(),[L,Be]=ts(),O=rs(),[m,ce]=r.useState(""),[y,j]=r.useState(null),M=r.useRef(null),G=r.useRef(!1),Y=r.useRef(""),[H,_]=r.useState(null),[Z,ee]=r.useState([]),[Oe,de]=r.useState({}),[Ge,ue]=r.useState({}),[_e,ge]=r.useState({}),[Ve,fe]=r.useState({}),[$e,me]=r.useState({}),[he,V]=r.useState(!1),[Ae,De]=r.useState(null),$=r.useRef(null),A=r.useRef(null),pe=r.useCallback(async()=>{if(A.current)return A.current;const e=await Re(()=>import("./equipment-sIOEhpr0.js"),[]);return A.current=e.default,A.current},[]),S=r.useCallback(async()=>{if($.current)return $.current;const e=await Re(()=>import("./ilvls-Bj6OKdVo.js"),[]);return $.current=e.default,$.current},[]);r.useEffect(()=>{if(G.current)return;const e=`${O.pathname}?${O.search}`;if(Y.current===e)return;const i=L.get("ilvl"),c=L.get("category");if(i){const o=parseInt(i,10);!isNaN(o)&&o>=1&&o<=999&&(G.current=!0,ce(i),S().then(n=>{const a=Object.entries(n).filter(([d,T])=>T===o);a.length>0&&j({valid:!0,message:`找到 ${a.length} 個物品`})}),_(c||null),Y.current=e)}else Y.current=e},[O.pathname,O.search,L,S]);const[ve,xe]=r.useState(!1),D=r.useRef(null);r.useEffect(()=>{const e=L.get("ilvl");e&&G.current&&m===e&&y?.valid&&w&&(G.current=!1,xe(!0))},[m,y,L,w]),r.useEffect(()=>{ve&&m&&y?.valid&&w&&D.current&&(xe(!1),setTimeout(()=>{D.current&&D.current()},100))},[ve,m,y,w]);const se=r.useMemo(()=>{const e=new Map;Object.entries(ie).forEach(([c,o])=>{Object.entries(o).forEach(([n,a])=>{if(n!=="SoulCrystal"&&(a===1||a===-1)){const d=n==="FingerL"||n==="FingerR"?"Rings":n;e.has(d)||e.set(d,{name:d,translatedName:ls[d]||d})}})});const i=["MainHand","OffHand","Head","Body","Gloves","Legs","Feet","Ears","Neck","Wrists","Rings"];return Array.from(e.values()).sort((c,o)=>{const n=i.indexOf(c.name),a=i.indexOf(o.name);return n===-1?1:a===-1?-1:n-a})},[]),ye=r.useCallback((e,i,c)=>{if(!i)return!0;const o=c[e.toString()];if(!o||o.equipSlotCategory===void 0)return!1;const n=o.equipSlotCategory,a=ie[n.toString()];return a?i==="Rings"?a.FingerL===1||a.FingerL===-1||a.FingerR===1||a.FingerR===-1:i==="SoulCrystal"?!1:a[i]===1||a[i]===-1:!1},[]),be=r.useCallback((e,i)=>{const c=i[e.toString()];if(!c||c.equipSlotCategory===void 0)return!1;const o=c.equipSlotCategory,n=ie[o.toString()];return n?se.some(a=>a.name==="Rings"?n.FingerL===1||n.FingerL===-1||n.FingerR===1||n.FingerR===-1:a.name==="SoulCrystal"?!1:n[a.name]===1||n[a.name]===-1):!1},[se]),Te=r.useCallback(e=>{ce(e),M.current&&clearTimeout(M.current),M.current=setTimeout(async()=>{const i=parseInt(e,10);if(e===""){j(null);return}if(isNaN(i)||i<1||i>999){j({valid:!1,message:"請輸入1-999之間的數字"});return}const c=await S(),o=Object.entries(c).filter(([n,a])=>a===i);o.length===0?j({valid:!1,message:"此物品等級沒有物品"}):j({valid:!0,message:`找到 ${o.length} 個物品`})},1e3)},[S]);r.useEffect(()=>()=>{M.current&&clearTimeout(M.current)},[]);const te=r.useCallback(async()=>{if(I)return;const e=parseInt(m,10);if(isNaN(e)||e<1||e>999){x("請輸入有效的物品等級","error");return}const i=L.get("ilvl"),c=L.get("category");if(i!==m||c!==(H||"")){const n=new URLSearchParams;n.set("ilvl",m),H?n.set("category",H):n.delete("category"),X(`/msq-price-checker?${n.toString()}`,{replace:!0})}ee([]),de({}),ue({}),ge({}),fe({}),me({});try{const[n,a]=await Promise.all([S(),pe()]);let d=Object.entries(n).filter(([l,u])=>u===e).map(([l,u])=>parseInt(l,10));if(d.length===0){x("未找到該物品等級的物品","warning"),ee([]);return}if(H?d=d.filter(l=>ye(l,H,a)):d=d.filter(l=>be(l,a)),d.length===0){x("該裝備分類中沒有相符的物品","warning");return}const T=await Je();De(T);const U=d.filter(l=>T.has(l));if(U.length===0){x("沒有可交易的物品","warning");return}const Ue=U.map(l=>ns(l)),Fe=(await Promise.all(Ue)).filter(l=>l!==null);if(Fe.length===0){x("無法獲取物品信息","error");return}const ze=Fe.map(l=>{const u=a[l.id.toString()];return{...l,ilvl品級:e,需求等級:u?.level||0,equipSlotCategory:u?.equipSlotCategory,jobs:u?.jobs||[]}}).sort((l,u)=>l.需求等級!==u.需求等級?l.需求等級-u.需求等級:l.name.localeCompare(u.name));if(ee(ze),V(!0),!p||!f){x("請選擇伺服器","warning"),V(!1);return}const re=f===p.section,Qe=re?p.section:f,Le=100,He={},qe={},Ne={},Se={},P={};for(let l=0;l<U.length;l+=Le){const u=U.slice(l,l+Le),Ke=u.join(",");try{const R=(await is.get(`https://universalis.app/api/v2/aggregated/${encodeURIComponent(Qe)}/${Ke}`)).data;R&&R.results&&R.results.forEach(s=>{const B=s.itemId,z=(q,N,b)=>{const W=q?.world?.[b],v=N?.world?.[b],F=q?.dc?.[b],h=N?.dc?.[b],g=W!==void 0?W:F,E=v!==void 0?v:h;if(b==="quantity"){if(g!==void 0||E!==void 0)return(g||0)+(E||0)}else{if(g!==void 0&&E!==void 0)return Math.min(g,E);if(E!==void 0)return E;if(g!==void 0)return g}return null},ne=z(s.nq?.dailySaleVelocity,s.hq?.dailySaleVelocity,"quantity"),ae=z(s.nq?.averageSalePrice,s.hq?.averageSalePrice,"price"),Q=z(s.nq?.minListing,s.hq?.minListing,"price"),K=z(s.nq?.recentPurchase,s.hq?.recentPurchase,"price");let C=null;if(Q!=null)if(re)C=Q;else{const q=s.nq?.minListing?.world?.price,N=s.hq?.minListing?.world?.price,b=s.nq?.minListing?.dc?.price,W=s.hq?.minListing?.dc?.price,v=q!==void 0?q:b,F=N!==void 0?N:W;let h=null;v!==void 0&&F!==void 0?h=F<=v?s.hq?.minListing?.world||s.hq?.minListing?.dc:s.nq?.minListing?.world||s.nq?.minListing?.dc:F!==void 0?h=s.hq?.minListing?.world||s.hq?.minListing?.dc:v!==void 0&&(h=s.nq?.minListing?.world||s.nq?.minListing?.dc);const g=h?.region;C={price:Q},g!==void 0&&(C.region=g)}let k=null;if(K!=null)if(re)k=K;else{const q=s.nq?.recentPurchase?.world?.price,N=s.hq?.recentPurchase?.world?.price,b=s.nq?.recentPurchase?.dc?.price,W=s.hq?.recentPurchase?.dc?.price,v=q!==void 0?q:b,F=N!==void 0?N:W;let h=null;v!==void 0&&F!==void 0?h=F<=v?s.hq?.recentPurchase?.world||s.hq?.recentPurchase?.dc:s.nq?.recentPurchase?.world||s.nq?.recentPurchase?.dc:F!==void 0?h=s.hq?.recentPurchase?.world||s.hq?.recentPurchase?.dc:v!==void 0&&(h=s.nq?.recentPurchase?.world||s.nq?.recentPurchase?.dc);const g=h?.region;k={price:K},g!==void 0&&(k.region=g)}ne!=null&&(He[B]=ne),ae!=null&&(qe[B]=Math.round(ae)),C!=null&&(Ne[B]=C),k!=null&&(Se[B]=k),P[B]=!0}),u.forEach(s=>{P.hasOwnProperty(s)||(P[s]=!1)})}catch(Pe){console.error("Error fetching market data:",Pe),u.forEach(R=>{P.hasOwnProperty(R)||(P[R]=!1)})}}de(He),ue(qe),ge(Ne),fe(Se),me(P),V(!1)}catch(n){console.error("Search error:",n),x("搜索失敗，請稍後再試","error"),V(!1)}},[m,H,p,f,x,ye,be,L,Be,S,pe]);return r.useEffect(()=>{D.current=te},[te]),t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white",children:[t.jsx(Xe,{onSearch:je,isSearching:I,searchText:Me,setSearchText:oe,isServerDataLoaded:w,selectedDcName:p?.section,onItemSelect:J,showNavigationButtons:!0,activePage:"msq-price-checker",onMSQPriceCheckerClick:()=>{oe(""),X("/msq-price-checker")}}),t.jsx("div",{className:"fixed right-2 mid:right-4 left-2 mid:left-auto z-50 space-y-2 max-w-sm mid:max-w-none top-[60px] mid:top-4",children:ke.map(e=>t.jsx(Ye,{message:e.message,type:e.type,onClose:()=>Ce(e.id)},e.id))}),t.jsx("div",{className:"pt-24 pb-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-ffxiv-gold mb-2",children:"主線裝備查價"}),t.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"主線拿到的箱子可以快速查看市場價格。"})]}),t.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4 sm:p-6 mb-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"物品等級 (ilvl品級)"}),t.jsx("div",{className:"flex items-end gap-3",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{type:"number",inputMode:"numeric",value:m,onChange:e=>Te(e.target.value),placeholder:"輸入物品等級...",className:"w-full px-3 py-2 bg-slate-900/50 border border-purple-500/30 rounded-lg text-white focus:outline-none focus:border-ffxiv-gold",min:"1",max:"999"}),y&&t.jsx("div",{className:`mt-2 text-xs ${y.valid?"text-green-400":"text-yellow-400"}`,children:y.message})]})})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"裝備分類 (可選)"}),t.jsxs("div",{className:"flex flex-wrap gap-2 max-h-48 overflow-y-auto p-2 bg-slate-900/30 rounded-lg border border-purple-500/20",children:[t.jsx("button",{onClick:()=>_(null),className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all ${H===null?"bg-ffxiv-gold text-slate-900 border-2 border-ffxiv-gold":"bg-slate-800/50 text-gray-300 border border-purple-500/30 hover:bg-purple-800/40 hover:border-purple-400/50"}`,children:"全部分類"}),se.map(e=>{const i=H===e.name;return t.jsx("button",{onClick:()=>_(e.name),className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all ${i?"bg-ffxiv-gold text-slate-900 border-2 border-ffxiv-gold":"bg-slate-800/50 text-gray-300 border border-purple-500/30 hover:bg-purple-800/40 hover:border-purple-400/50"}`,children:e.translatedName},e.name)})]})]}),p&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"伺服器選擇"}),t.jsx(Ze,{datacenters:We,worlds:le,selectedWorld:p,onWorldChange:Ee,selectedServerOption:f,onServerOptionChange:we,serverOptions:Ie,disabled:he})]}),t.jsx("button",{onClick:te,disabled:I||!m||!y?.valid,className:`w-full py-3 rounded-lg font-semibold transition-all ${I||!m||!y?.valid?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-gradient-to-r from-ffxiv-gold to-yellow-500 text-slate-900 hover:shadow-[0_0_20px_rgba(212,175,55,0.5)]"}`,children:I?"搜索中...":"搜索"})]}),Z.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-ffxiv-gold",children:["搜索結果 (",Z.length," 個物品)"]}),p&&f&&t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border border-purple-500/30 rounded-lg backdrop-blur-sm",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-ffxiv-gold animate-pulse"}),t.jsx("span",{className:"text-xs sm:text-sm font-semibold text-ffxiv-gold",children:f===p.section?`${p.section} (全服)`:le[f]||`伺服器 ${f}`})]})]}),t.jsx(es,{items:Z,onSelect:e=>{if(J){const i=new URLSearchParams;f&&i.set("server",f);const c=i.toString(),o=`/item/${e.id}${c?"?"+c:""}`;J(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>{X(o,{replace:!0})})})}},selectedItem:null,marketableItems:Ae,itemVelocities:Oe,itemAveragePrices:Ge,itemMinListings:_e,itemRecentPurchases:Ve,itemTradability:$e,isLoadingVelocities:he,averagePriceHeader:"平均價格",getSimplifiedChineseName:as,addToast:x})]})]})})]})}export{hs as default};
