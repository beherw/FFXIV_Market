import{_ as Le,g as Qe,T as ze,a as Ke,S as Je,I as Xe}from"./index-lgBfnuzz.js";import{u as Ye,b as Ze,a as et,r as s,j as t}from"./react-vendor-DmEpS5Kz.js";import{g as tt,b as st}from"./services-data-rxdqLngZ.js";import{a as at}from"./axios-B9ygI19o.js";import"./vendor-dPMYpV4t.js";import"./opencc-C1Qz6KEM.js";import"./teamcraft-data-u2h6--oi.js";const X={1:{MainHand:1,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},2:{MainHand:0,OffHand:1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},3:{MainHand:0,OffHand:0,Head:1,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},4:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},5:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:1,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},6:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:1,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},7:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},8:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},9:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:1,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},10:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:1,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},11:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:1,FingerL:0,FingerR:0,SoulCrystal:0},12:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:1,FingerR:1,SoulCrystal:0},13:{MainHand:1,OffHand:-1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},14:{MainHand:1,OffHand:1,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},15:{MainHand:0,OffHand:0,Head:-1,Body:1,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},16:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},17:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:1},18:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},19:{MainHand:0,OffHand:0,Head:-1,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},20:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:-1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},21:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:-1,Feet:-1,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},22:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:-1,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},23:{MainHand:0,OffHand:0,Head:0,Body:1,Gloves:0,Waist:0,Legs:-1,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0},24:{MainHand:0,OffHand:0,Head:0,Body:0,Gloves:0,Waist:0,Legs:0,Feet:0,Ears:0,Neck:0,Wrists:0,FingerL:0,FingerR:0,SoulCrystal:0}},rt={MainHand:"主手武器",OffHand:"副手",Head:"頭部",Body:"身體",Gloves:"手套",Waist:"腰部",Legs:"腿部",Feet:"腳部",Ears:"耳環",Neck:"項鍊",Wrists:"手環",Rings:"戒指"};function gt({addToast:p,removeToast:Ne,toasts:Se,datacenters:Re,worlds:Y,selectedWorld:m,onWorldChange:Ce,selectedServerOption:f,onServerOptionChange:ke,serverOptions:Ee,isServerDataLoaded:N,onItemSelect:_,onSearch:We,searchText:Ie,setSearchText:Z,isSearching:S}){const V=Ye(),[h,je]=Ze(),W=et(),[g,ee]=s.useState(""),[v,R]=s.useState(null),C=s.useRef(null),I=s.useRef(!1),$=s.useRef(""),[x,j]=s.useState(null),[A,D]=s.useState([]),[Me,te]=s.useState({}),[qe,se]=s.useState({}),[we,ae]=s.useState({}),[Pe,re]=s.useState({}),[Be,ne]=s.useState({}),[ie,M]=s.useState(!1),[Oe,Ge]=s.useState(null),q=s.useRef(null),w=s.useRef(null),le=s.useCallback(async()=>{if(w.current)return w.current;const e=await Le(()=>import("./equipment-sIOEhpr0.js"),[]);return w.current=e.default,w.current},[]),y=s.useCallback(async()=>{if(q.current)return q.current;const e=await Le(()=>import("./ilvls-Bj6OKdVo.js"),[]);return q.current=e.default,q.current},[]);s.useEffect(()=>{if(I.current)return;const e=`${W.pathname}?${W.search}`;if($.current===e)return;const n=h.get("ilvl"),o=h.get("category");if(n){const l=parseInt(n,10);!isNaN(l)&&l>=1&&l<=999&&(I.current=!0,ee(n),y().then(a=>{const r=Object.entries(a).filter(([c,B])=>B===l);r.length>0&&R({valid:!0,message:`找到 ${r.length} 個物品`})}),j(o||null),$.current=e)}else $.current=e},[W.pathname,W.search,h,y]);const[oe,ce]=s.useState(!1),P=s.useRef(null);s.useEffect(()=>{const e=h.get("ilvl");e&&I.current&&g===e&&v?.valid&&N&&(I.current=!1,ce(!0))},[g,v,h,N]),s.useEffect(()=>{oe&&g&&v?.valid&&N&&P.current&&(ce(!1),setTimeout(()=>{P.current&&P.current()},100))},[oe,g,v,N]);const T=s.useMemo(()=>{const e=new Map;Object.entries(X).forEach(([o,l])=>{Object.entries(l).forEach(([a,r])=>{if(a!=="SoulCrystal"&&(r===1||r===-1)){const c=a==="FingerL"||a==="FingerR"?"Rings":a;e.has(c)||e.set(c,{name:c,translatedName:rt[c]||c})}})});const n=["MainHand","OffHand","Head","Body","Gloves","Legs","Feet","Ears","Neck","Wrists","Rings"];return Array.from(e.values()).sort((o,l)=>{const a=n.indexOf(o.name),r=n.indexOf(l.name);return a===-1?1:r===-1?-1:a-r})},[]),ue=s.useCallback((e,n,o)=>{if(!n)return!0;const l=o[e.toString()];if(!l||l.equipSlotCategory===void 0)return!1;const a=l.equipSlotCategory,r=X[a.toString()];return r?n==="Rings"?r.FingerL===1||r.FingerL===-1||r.FingerR===1||r.FingerR===-1:n==="SoulCrystal"?!1:r[n]===1||r[n]===-1:!1},[]),de=s.useCallback((e,n)=>{const o=n[e.toString()];if(!o||o.equipSlotCategory===void 0)return!1;const l=o.equipSlotCategory,a=X[l.toString()];return a?T.some(r=>r.name==="Rings"?a.FingerL===1||a.FingerL===-1||a.FingerR===1||a.FingerR===-1:r.name==="SoulCrystal"?!1:a[r.name]===1||a[r.name]===-1):!1},[T]),_e=s.useCallback(e=>{ee(e),C.current&&clearTimeout(C.current),C.current=setTimeout(async()=>{const n=parseInt(e,10);if(e===""){R(null);return}if(isNaN(n)||n<1||n>999){R({valid:!1,message:"請輸入1-999之間的數字"});return}const o=await y(),l=Object.entries(o).filter(([a,r])=>r===n);l.length===0?R({valid:!1,message:"此物品等級沒有物品"}):R({valid:!0,message:`找到 ${l.length} 個物品`})},1e3)},[y]);s.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]);const U=s.useCallback(async()=>{if(S)return;const e=parseInt(g,10);if(isNaN(e)||e<1||e>999){p("請輸入有效的物品等級","error");return}const n=h.get("ilvl"),o=h.get("category");if(n!==g||o!==(x||"")){const a=new URLSearchParams;a.set("ilvl",g),x?a.set("category",x):a.delete("category"),V(`/msq-price-checker?${a.toString()}`,{replace:!0})}D([]),te({}),se({}),ae({}),re({}),ne({});try{const[a,r]=await Promise.all([y(),le()]);let c=Object.entries(a).filter(([i,u])=>u===e).map(([i,u])=>parseInt(i,10));if(c.length===0){p("未找到該物品等級的物品","warning"),D([]);return}if(x?c=c.filter(i=>ue(i,x,r)):c=c.filter(i=>de(i,r)),c.length===0){p("該裝備分類中沒有相符的物品","warning");return}const B=await Qe();Ge(B);const O=c.filter(i=>B.has(i));if(O.length===0){p("沒有可交易的物品","warning");return}const Ve=O.map(i=>tt(i)),fe=(await Promise.all(Ve)).filter(i=>i!==null);if(fe.length===0){p("無法獲取物品信息","error");return}const $e=fe.map(i=>{const u=r[i.id.toString()];return{...i,ilvl品級:e,需求等級:u?.level||0,equipSlotCategory:u?.equipSlotCategory,jobs:u?.jobs||[]}}).sort((i,u)=>i.需求等級!==u.需求等級?i.需求等級-u.需求等級:i.name.localeCompare(u.name));if(D($e),M(!0),!m||!f){p("請選擇伺服器","warning"),M(!1);return}const Ae=f===m.section?m.section:f,ge=100,me={},pe={},ve={},he={},b={};for(let i=0;i<O.length;i+=ge){const u=O.slice(i,i+ge),De=u.join(",");try{const F=(await at.get(`https://universalis.app/api/v2/aggregated/${encodeURIComponent(Ae)}/${De}`)).data;F&&F.results&&F.results.forEach(d=>{const k=d.itemId,G=(ye,be,E)=>{const Fe=ye?.world?.[E],He=be?.world?.[E],Te=ye?.dc?.[E],Ue=be?.dc?.[E],H=Fe!==void 0?Fe:Te,L=He!==void 0?He:Ue;if(E==="quantity"){if(H!==void 0||L!==void 0)return(H||0)+(L||0)}else{if(H!==void 0&&L!==void 0)return Math.min(H,L);if(L!==void 0)return L;if(H!==void 0)return H}return null},Q=G(d.nq?.dailySaleVelocity,d.hq?.dailySaleVelocity,"quantity"),z=G(d.nq?.averageSalePrice,d.hq?.averageSalePrice,"price"),K=G(d.nq?.minListing,d.hq?.minListing,"price"),J=G(d.nq?.recentPurchase,d.hq?.recentPurchase,"price");Q!=null&&(me[k]=Q),z!=null&&(pe[k]=Math.round(z)),K!=null&&(ve[k]=K),J!=null&&(he[k]=J),b[k]=!0}),u.forEach(d=>{b.hasOwnProperty(d)||(b[d]=!1)})}catch(xe){console.error("Error fetching market data:",xe),u.forEach(F=>{b.hasOwnProperty(F)||(b[F]=!1)})}}te(me),se(pe),ae(ve),re(he),ne(b),M(!1)}catch(a){console.error("Search error:",a),p("搜索失敗，請稍後再試","error"),M(!1)}},[g,x,m,f,p,ue,de,h,je,y,le]);return s.useEffect(()=>{P.current=U},[U]),t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white",children:[t.jsx(ze,{onSearch:We,isSearching:S,searchText:Ie,setSearchText:Z,isServerDataLoaded:N,selectedDcName:m?.section,onItemSelect:_,showNavigationButtons:!0,activePage:"msq-price-checker",onMSQPriceCheckerClick:()=>{Z(""),V("/msq-price-checker")}}),t.jsx("div",{className:"fixed right-2 mid:right-4 left-2 mid:left-auto z-50 space-y-2 max-w-sm mid:max-w-none top-[60px] mid:top-4",children:Se.map(e=>t.jsx(Ke,{message:e.message,type:e.type,onClose:()=>Ne(e.id)},e.id))}),t.jsx("div",{className:"pt-24 pb-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-ffxiv-gold mb-2",children:"主線裝備查價"}),t.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"主線拿到的箱子可以快速查看市場價格。"})]}),t.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4 sm:p-6 mb-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"物品等級 (ilvl品級)"}),t.jsx("div",{className:"flex items-end gap-3",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{type:"number",inputMode:"numeric",value:g,onChange:e=>_e(e.target.value),placeholder:"輸入物品等級...",className:"w-full px-3 py-2 bg-slate-900/50 border border-purple-500/30 rounded-lg text-white focus:outline-none focus:border-ffxiv-gold",min:"1",max:"999"}),v&&t.jsx("div",{className:`mt-2 text-xs ${v.valid?"text-green-400":"text-yellow-400"}`,children:v.message})]})})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"裝備分類 (可選)"}),t.jsxs("div",{className:"flex flex-wrap gap-2 max-h-48 overflow-y-auto p-2 bg-slate-900/30 rounded-lg border border-purple-500/20",children:[t.jsx("button",{onClick:()=>j(null),className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all ${x===null?"bg-ffxiv-gold text-slate-900 border-2 border-ffxiv-gold":"bg-slate-800/50 text-gray-300 border border-purple-500/30 hover:bg-purple-800/40 hover:border-purple-400/50"}`,children:"全部分類"}),T.map(e=>{const n=x===e.name;return t.jsx("button",{onClick:()=>j(e.name),className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all ${n?"bg-ffxiv-gold text-slate-900 border-2 border-ffxiv-gold":"bg-slate-800/50 text-gray-300 border border-purple-500/30 hover:bg-purple-800/40 hover:border-purple-400/50"}`,children:e.translatedName},e.name)})]})]}),m&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold text-ffxiv-gold mb-2",children:"伺服器選擇"}),t.jsx(Je,{datacenters:Re,worlds:Y,selectedWorld:m,onWorldChange:Ce,selectedServerOption:f,onServerOptionChange:ke,serverOptions:Ee,disabled:ie})]}),t.jsx("button",{onClick:U,disabled:S||!g||!v?.valid,className:`w-full py-3 rounded-lg font-semibold transition-all ${S||!g||!v?.valid?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-gradient-to-r from-ffxiv-gold to-yellow-500 text-slate-900 hover:shadow-[0_0_20px_rgba(212,175,55,0.5)]"}`,children:S?"搜索中...":"搜索"})]}),A.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-ffxiv-gold",children:["搜索結果 (",A.length," 個物品)"]}),m&&f&&t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border border-purple-500/30 rounded-lg backdrop-blur-sm",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-ffxiv-gold animate-pulse"}),t.jsx("span",{className:"text-xs sm:text-sm font-semibold text-ffxiv-gold",children:f===m.section?`${m.section} (全服)`:Y[f]||`伺服器 ${f}`})]})]}),t.jsx(Xe,{items:A,onSelect:e=>{if(_){const n=new URLSearchParams;f&&n.set("server",f);const o=n.toString(),l=`/item/${e.id}${o?"?"+o:""}`;_(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>{V(l,{replace:!0})})})}},selectedItem:null,marketableItems:Oe,itemVelocities:Me,itemAveragePrices:qe,itemMinListings:we,itemRecentPurchases:Pe,itemTradability:Be,isLoadingVelocities:ie,averagePriceHeader:"平均價格",getSimplifiedChineseName:st,addToast:p})]})]})})]})}export{gt as default};
