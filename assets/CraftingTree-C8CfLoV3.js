import{r as o,j as e}from"./react-vendor-DmEpS5Kz.js";import{b as J,c as K}from"./index-DyGS1t-p.js";import{g as G}from"./services-data-rxdqLngZ.js";import"./vendor-dPMYpV4t.js";import"./axios-B9ygI19o.js";import"./opencc-C1Qz6KEM.js";import"./teamcraft-data-u2h6--oi.js";function Y({text:s,onCopy:t}){const[a,i]=o.useState(!1),r=async h=>{h.stopPropagation();try{await navigator.clipboard.writeText(s),i(!0),t&&t(),setTimeout(()=>i(!1),1500)}catch(u){console.error("Failed to copy:",u)}};return e.jsx("button",{onClick:r,className:`
        p-0.5 rounded transition-all duration-200 flex-shrink-0
        ${a?"text-green-400":"text-gray-500 hover:text-ffxiv-gold hover:bg-purple-800/40"}
      `,title:a?"已複製":"複製名稱",children:a?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})}function Z({node:s,itemName:t,priceInfo:a,onItemClick:i,isRoot:r=!1,isLoading:h=!1,isPriceQueried:u=!1,nodeRef:c,isHighlighted:f=!1,highlightMethod:d=null}){return e.jsxs("div",{ref:c,className:`
        flex flex-col items-center p-2 rounded-lg cursor-pointer transition-all duration-200
        ${r?"bg-gradient-to-br from-ffxiv-gold/20 to-yellow-500/10 border-2 border-ffxiv-gold/50 hover:border-ffxiv-gold min-w-[120px]":f?d==="craft"?"bg-gradient-to-br from-green-900/40 to-emerald-900/30 border-2 border-green-500/60 hover:border-green-400 min-w-[100px] shadow-[0_0_10px_rgba(34,197,94,0.2)]":"bg-gradient-to-br from-blue-900/40 to-cyan-900/30 border-2 border-blue-500/60 hover:border-blue-400 min-w-[100px] shadow-[0_0_10px_rgba(59,130,246,0.2)]":"bg-slate-800/60 border border-purple-500/30 hover:border-purple-400/60 hover:bg-slate-700/60 min-w-[100px]"}
      `,onClick:()=>i(s.itemId),title:`查看 ${t}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{itemId:s.itemId,alt:t,className:`${r?"w-12 h-12":"w-9 h-9"} object-contain rounded border border-purple-500/30`,priority:r}),!r&&s.amount>1&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-purple-900/90 text-ffxiv-gold text-xs font-bold px-1 py-0.5 rounded-full border border-purple-500/50 min-w-[18px] text-center leading-none",children:s.amount})]}),e.jsxs("div",{className:`mt-1.5 flex items-center gap-0.5 max-w-[100px] ${r?"max-w-[120px]":""}`,children:[e.jsx("p",{className:`${r?"text-xs font-semibold text-ffxiv-gold":"text-xs text-gray-300"} truncate flex-1`,title:t,children:t}),e.jsx(Y,{text:t})]}),e.jsx("div",{className:`mt-1 text-center ${a?.worldName?"h-[32px]":"h-[20px]"} flex flex-col justify-center`,children:h?e.jsx("div",{className:"text-xs text-gray-500 animate-pulse",children:"載入中..."}):a?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[a.isHQ&&e.jsx("span",{className:"px-1 py-0.5 text-[10px] font-bold text-ffxiv-gold border border-ffxiv-gold/50 rounded bg-ffxiv-gold/10 cursor-default",children:"HQ"}),e.jsx("span",{className:`text-xs font-semibold ${a.isHQ?"text-yellow-400":"text-green-400"}`,children:a.price.toLocaleString()})]}),a.worldName&&e.jsx("span",{className:"text-[10px] text-gray-500 truncate max-w-[80px]",title:a.worldName,children:a.worldName})]}):u?e.jsx("span",{className:"text-xs text-gray-500",children:"無販售"}):e.jsx("div",{className:"text-xs text-gray-500 animate-pulse",children:"查詢中..."})})]})}function T(s,t,a){const r=t[s.itemId]?.price??null,h=s.children&&s.children.length>0,u=a.has(s.itemId);if(!h)return u&&r===null?{cost:"N/A",method:"buy",breakdown:null}:{cost:r,method:"buy",breakdown:null};let c=!0;for(const C of s.children)if(!a.has(C.itemId)){c=!1;break}if(!c)return u&&r===null?{cost:"N/A",method:"buy",breakdown:null}:{cost:r,method:"buy",breakdown:null};let f=0,d=!1;const p=[];for(const C of s.children){const x=T(C,t,a);if(x.cost==="N/A"){d=!0;break}else if(x.cost!==null&&typeof x.cost=="number"){const g=x.cost*C.amount;f+=g,p.push({itemId:C.itemId,amount:C.amount,unitCost:x.cost,totalCost:g,method:x.method})}else{d=!0;break}}return d?r!==null?{cost:r,method:"buy",breakdown:null}:u?{cost:"N/A",method:"buy",breakdown:null}:{cost:null,method:"buy",breakdown:null}:r===null?u?{cost:f,method:"craft",breakdown:p}:{cost:null,method:"buy",breakdown:null}:f<r?{cost:f,method:"craft",breakdown:p}:{cost:r,method:"buy",breakdown:null}}function V(s,t,a,i=new Map){const r=T(s,t,a);if(i.set(s.itemId,r.method),r.method==="craft"&&s.children)for(const h of s.children)V(h,t,a,i);return i}function O({tree:s,itemPrices:t,queriedItemIds:a,itemNames:i}){const r=o.useMemo(()=>{if(!s||!s.children||s.children.length===0)return null;let p=!0;for(const j of s.children)if(!a.has(j.itemId)){p=!1;break}if(!p||!a.has(s.itemId))return null;const x=T(s,t,a);if(x.cost===null)return null;const g=t[s.itemId]?.price??null,v=x.cost,H=g===null,M=v==="N/A",w=typeof v=="number";return M&&H?{canCraft:!1,isInsufficientInfo:!0}:M&&g!==null?{rootPrice:g,cheapestRouteCost:"N/A",canCraft:!0,isMaterialsNA:!0,isCraftOnly:!1}:w&&H?x.method==="craft"?{rootPrice:null,cheapestRouteCost:v,canCraft:!0,isCraftOnly:!0}:{canCraft:!1}:w&&g!==null?{rootPrice:g,cheapestRouteCost:v,savings:g-v,canCraft:!0,isCraftOnly:!1}:{canCraft:!1}},[s,t,a]);if(!r)return null;if(r.isInsufficientInfo)return e.jsx("div",{className:"px-4 py-2.5 rounded-lg text-sm font-medium bg-orange-900/50 border border-orange-500/40 text-orange-300 w-max min-w-max",children:e.jsx("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"該服缺乏關鍵素材且無成品購買"})]})})});if(!r.canCraft)return null;if(r.isMaterialsNA)return e.jsx("div",{className:"px-4 py-2.5 rounded-lg text-sm font-medium bg-blue-900/50 border border-blue-500/40 text-blue-300 w-max min-w-max",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs opacity-70 text-center whitespace-nowrap",children:"以最優路線計算（每項材料取買/製的較低價）"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm whitespace-nowrap",children:[e.jsx("span",{className:"flex-shrink-0",children:"最優製作: N/A"}),e.jsx("span",{className:"opacity-60 flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:["直購成品: ",r.rootPrice.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"建議直購"})]})]})});if(r.isCraftOnly)return e.jsx("div",{className:"px-4 py-2.5 rounded-lg text-sm font-medium bg-green-900/50 border border-green-500/40 text-green-300 w-max min-w-max",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs opacity-70 text-center whitespace-nowrap",children:"以最優路線計算（每項材料取買/製的較低價）"}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["自製最佳: ",r.cheapestRouteCost.toLocaleString()]})]})]})});const{rootPrice:h,cheapestRouteCost:u,savings:c}=r,f=c>0,d=Math.abs(c);return d===0?e.jsx("div",{className:"px-3 py-2 rounded-lg bg-gray-700/50 border border-gray-500/30 text-sm text-gray-400 w-max min-w-max whitespace-nowrap",children:"價格相同"}):e.jsx("div",{className:`
        px-4 py-2.5 rounded-lg text-sm font-medium w-max min-w-max
        ${f?"bg-green-900/50 border border-green-500/40 text-green-300":"bg-red-900/50 border border-red-500/40 text-red-300"}
      `,children:e.jsxs("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs opacity-70 text-center whitespace-nowrap",children:"以最優路線計算（每項材料取買/製的較低價）"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["最優製作: ",u.toLocaleString()]}),e.jsx("span",{className:"opacity-60 flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:["直購成品: ",h.toLocaleString()]})]}),e.jsx("div",{className:"flex items-center gap-1.5 mt-0.5 whitespace-nowrap",children:f?e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["建議自製，省 ",d.toLocaleString()]})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["建議直購，省 ",d.toLocaleString()]})]})})]})})}function q({parentPrice:s,childrenTotalPrice:t,isReady:a,amount:i=1}){if(!a)return null;const r=s!=null,h=t!==null&&t!=="N/A"&&typeof t=="number",u=t==="N/A",c=s==null;if(u&&c)return e.jsx("div",{className:"px-2 py-1 rounded-lg bg-gray-700/50 border border-gray-500/30 text-xs text-gray-400",children:"資訊不足"});if(u&&r)return e.jsx("div",{className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-blue-900/50 border border-blue-500/40 text-blue-300 w-max min-w-max",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 whitespace-nowrap",children:[e.jsx("span",{className:"flex-shrink-0",children:"材料: N/A"}),e.jsx("span",{className:"flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:[i>1?`${i}個`:"","成品: ",s.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"建議直購"})]})]})});if(h&&c)return e.jsx("div",{className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-green-900/50 border border-green-500/40 text-green-300 w-max min-w-max",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["材料: ",t.toLocaleString()]}),e.jsx("span",{className:"flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:[i>1?`${i}個`:"","成品: N/A"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"建議自製"})]})]})});if(!h||!r)return null;const f=s-t,d=f>0,p=Math.abs(f);return p===0?e.jsx("div",{className:"px-2 py-1 rounded-lg bg-gray-700/50 border border-gray-500/30 text-xs text-gray-400",children:"價格相同"}):e.jsx("div",{className:`
        px-3 py-1.5 rounded-lg text-xs font-medium w-max min-w-max
        ${d?"bg-green-900/50 border border-green-500/40 text-green-300":"bg-red-900/50 border border-red-500/40 text-red-300"}
      `,children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["材料: ",t.toLocaleString()]}),e.jsx("span",{className:"flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:[i>1?`${i}個`:"","成品: ",s.toLocaleString()]})]}),e.jsx("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:d?e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["自製省 ",p.toLocaleString()]})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["直購省 ",p.toLocaleString()]})]})})]})})}function U({node:s,itemNames:t,itemPrices:a,queriedItemIds:i,onItemClick:r,isRoot:h=!1,isLoading:u=!1,optimalPathMap:c=null,isCraftingCheaper:f=!1}){const d=o.useRef(null),[p,C]=o.useState({left:0,width:0}),x=s.children&&s.children.length>0,g=t[s.itemId]||`物品 ${s.itemId}`,v=a[s.itemId],H=i.has(s.itemId),M=c?.get(s.itemId),w=f&&M!==void 0,j=w&&M==="craft",Q=o.useMemo(()=>{if(!x)return null;let b=!0;for(const N of s.children)if(!i.has(N.itemId)){b=!1;break}if(!b)return null;let m=0,I=!1;for(const N of s.children){const S=a[N.itemId];S&&S.price!==void 0?m+=S.price*N.amount:I=!0}return I?"N/A":m},[x,s.children,a,i]),$=o.useMemo(()=>{if(!x)return!1;let b=!0;for(const I of s.children)if(!i.has(I.itemId)){b=!1;break}return!b||Q===null?!1:i.has(s.itemId)},[x,s.children,v,Q,i]),z=o.useCallback(()=>{if(x&&s.children.length>1&&d.current){const b=d.current,m=b.children;if(m.length>=2){const I=m[0],N=m[m.length-1],S=b.getBoundingClientRect(),E=I.getBoundingClientRect(),P=N.getBoundingClientRect(),A=E.left+E.width/2-S.left,_=P.left+P.width/2-S.left;_-A>0&&C({left:A,width:_-A})}}},[x,s.children?.length]);o.useEffect(()=>{const b=setTimeout(z,50);let m;return d.current&&typeof ResizeObserver<"u"&&(m=new ResizeObserver(()=>{z()}),m.observe(d.current)),()=>{clearTimeout(b),m&&m.disconnect()}},[z,t,a]);const B=j?"bg-green-400":"bg-purple-500/50",D=j?"w-0.5":"w-px",R=j?"shadow-[0_0_6px_rgba(74,222,128,0.6)]":"";return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Z,{node:s,itemName:g,priceInfo:v,onItemClick:r,isRoot:h,isLoading:u,isPriceQueried:H,isHighlighted:w&&!h,highlightMethod:M}),x&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`${D} h-4 ${B} ${R}`}),h?e.jsx(O,{tree:s,itemPrices:a,queriedItemIds:i,itemNames:t}):e.jsx(q,{parentPrice:v?.price?v.price*s.amount:null,childrenTotalPrice:Q,isReady:$,amount:s.amount}),e.jsx("div",{className:`${D} h-4 ${B} ${R}`}),e.jsxs("div",{className:"relative",children:[s.children.length>1&&p.width>0&&e.jsx("div",{className:`absolute top-0 ${j?"h-0.5":"h-px"} ${B} ${R}`,style:{left:`${p.left}px`,width:`${p.width}px`}}),e.jsx("div",{ref:d,className:"flex gap-3 items-start",children:s.children.map((b,m)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`${j?"w-0.5 bg-green-400 shadow-[0_0_6px_rgba(74,222,128,0.6)]":"w-px bg-purple-500/50"} h-4`}),e.jsx(U,{node:b,itemNames:t,itemPrices:a,queriedItemIds:i,onItemClick:r,isLoading:u,optimalPathMap:c,isCraftingCheaper:f&&j})]},`${b.itemId}-${m}`))})]})]})]})}function ie({tree:s,selectedServerOption:t,selectedWorld:a,worlds:i={},onItemSelect:r}){const[h,u]=o.useState({}),[c,f]=o.useState({}),[d,p]=o.useState(new Set),[C,x]=o.useState(!0),[g,v]=o.useState(!0),[H,M]=o.useState(null),w=o.useRef(null),[j,Q]=o.useState(!1),[$,z]=o.useState(!1),[B,D]=o.useState(0),[R,b]=o.useState(0),m=o.useMemo(()=>{if(!t)return!1;const l=a?.section;return t===l},[t,a]),I=o.useMemo(()=>{if(!t)return null;const l=a?.section;if(t===l)return`${l}（全服搜尋）`;if(typeof t=="number"||!isNaN(Number(t))){const n=typeof t=="number"?t:Number(t);return i[n]||`伺服器 ${t}`}else return t},[t,a,i]),N=o.useCallback((l,n=new Set)=>(l&&(n.add(l.itemId),l.children&&l.children.forEach(k=>N(k,n))),n),[]);o.useEffect(()=>{if(!s)return;const l=Array.from(N(s));x(!0),Promise.all(l.map(async n=>{const k=await G(n);return{id:n,name:k?.name||`物品 ${n}`}})).then(n=>{const k={};n.forEach(({id:L,name:y})=>{k[L]=y}),u(k),x(!1)}).catch(n=>{console.error("Failed to load item names:",n),M("載入物品名稱失敗"),x(!1)})},[s,N]),o.useEffect(()=>{const l=i&&Object.keys(i).length>0;if(!s||!t||!l)return;const n=Array.from(N(s));v(!0),p(new Set),f({}),M(null),(async()=>{try{const L=[];for(let y=0;y<n.length;y+=100)L.push(n.slice(y,y+100));for(const y of L){const F=await J(t,y,i);f(W=>({...W,...F})),p(W=>new Set([...W,...y])),L.length>1&&await new Promise(W=>setTimeout(W,100))}}catch(L){console.error("Failed to fetch prices:",L),p(new Set(n))}v(!1)})()},[s,t,i,N]);const S=o.useCallback(l=>{if(r)G(l).then(n=>{if(n)r(n);else{const k=`${window.location.origin}/item/${l}`;window.open(k,"_blank","noopener,noreferrer")}});else{const n=`${window.location.origin}/item/${l}`;window.open(n,"_blank","noopener,noreferrer")}},[r]);o.useEffect(()=>{const l=()=>{if(w.current){const L=w.current,y=L.scrollWidth>L.clientWidth;Q(y)}};l();const n=new ResizeObserver(l);w.current&&n.observe(w.current);const k=setInterval(l,500);return()=>{n.disconnect(),clearInterval(k)}},[s,h,c]);const E=o.useCallback(l=>{if(!w.current||!j)return;const n=l.target;n.closest("button, a, [data-item-id], img, svg, path")||n.tagName==="BUTTON"||n.tagName==="A"||n.tagName==="IMG"||n.tagName==="SVG"||n.tagName==="PATH"||n.closest(".cursor-pointer")||(z(!0),D(l.clientX),b(w.current.scrollLeft),l.preventDefault(),l.stopPropagation())},[j]),P=o.useCallback(l=>{if(!$||!w.current)return;const n=l.clientX-B;w.current.scrollLeft=R-n,l.preventDefault(),l.stopPropagation()},[$,B,R]),A=o.useCallback(()=>{z(!1)},[]);o.useEffect(()=>{if($)return document.addEventListener("mousemove",P),document.addEventListener("mouseup",A),document.body.style.cursor="grabbing",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",A),document.body.style.cursor="",document.body.style.userSelect=""}},[$,P,A]);const{optimalPathMap:_,isCraftingCheaper:X}=o.useMemo(()=>{if(!s||g||Object.keys(c).length===0)return{optimalPathMap:null,isCraftingCheaper:!1};if(!s.children||s.children.length===0)return{optimalPathMap:null,isCraftingCheaper:!1};for(const F of s.children)if(!d.has(F.itemId))return{optimalPathMap:null,isCraftingCheaper:!1};const l=T(s,c,d);if(l.cost===null)return{optimalPathMap:null,isCraftingCheaper:!1};if(l.cost==="N/A")return{optimalPathMap:null,isCraftingCheaper:!1};const n=c[s.itemId]?.price??null;return n===null?l.method==="craft"&&typeof l.cost=="number"?{optimalPathMap:V(s,c,d),isCraftingCheaper:!0}:{optimalPathMap:null,isCraftingCheaper:!1}:typeof l.cost!="number"?{optimalPathMap:null,isCraftingCheaper:!1}:l.cost<n?{optimalPathMap:V(s,c,d),isCraftingCheaper:!0}:{optimalPathMap:null,isCraftingCheaper:!1}},[s,c,d,g]);return s?e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-ffxiv-gold flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"製作價格樹"]}),t&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-purple-900/40 border border-purple-500/30 text-xs",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})}),e.jsx("span",{className:"text-purple-300",children:I}),e.jsx("span",{className:"text-gray-500",children:"·"}),e.jsx("span",{className:"text-gray-400",children:m?"最低價":"平均價格"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!g&&s&&c[s.itemId]&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-slate-800/60 border border-slate-600/40 text-xs",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("span",{className:"text-gray-400",children:"日均銷量:"}),c[s.itemId].velocityWorld!==void 0&&e.jsxs("span",{className:"text-cyan-300",title:"單服日均銷量",children:["單服 ",c[s.itemId].velocityWorld.toFixed(1)]}),c[s.itemId].velocityWorld!==void 0&&c[s.itemId].velocityDc!==void 0&&e.jsx("span",{className:"text-gray-500",children:"/"}),c[s.itemId].velocityDc!==void 0&&e.jsxs("span",{className:"text-emerald-300",title:"全服日均銷量",children:["全服 ",c[s.itemId].velocityDc.toFixed(1)]})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-ffxiv-gold"}),"載入價格中..."]})]})]}),H&&e.jsx("div",{className:"mb-4 p-2 bg-red-900/30 border border-red-500/30 rounded text-sm text-red-400",children:H}),e.jsx("div",{ref:w,className:`overflow-x-auto pb-2 relative ${j&&!$?"cursor-grab":""} ${$?"cursor-grabbing":""}`,onMouseDown:E,onMouseLeave:()=>{$&&z(!1)},children:e.jsx("div",{className:"flex justify-center min-w-min py-2",children:e.jsx(U,{node:s,itemNames:h,itemPrices:c,queriedItemIds:d,onItemClick:S,isRoot:!0,isLoading:C,optimalPathMap:_,isCraftingCheaper:X})})}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-purple-500/20 flex flex-wrap gap-4 text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-ffxiv-gold/20 to-yellow-500/10 border border-ffxiv-gold/50"}),e.jsx("span",{children:"成品"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-slate-800/60 border border-purple-500/30"}),e.jsx("span",{children:"材料"})]}),X&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-900/40 to-emerald-900/30 border-2 border-green-500/60"}),e.jsx("span",{className:"text-green-400",children:"最優路線(製作)"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-blue-900/40 to-cyan-900/30 border-2 border-blue-500/60"}),e.jsx("span",{className:"text-blue-400",children:"最優路線(購買)"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-green-400 font-semibold",children:"價格"}),e.jsxs("span",{children:["= NQ",m?"最低價":"平均價"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"px-1 py-0.5 text-[10px] font-bold text-ffxiv-gold border border-ffxiv-gold/50 rounded bg-ffxiv-gold/10 cursor-default",children:"HQ"}),e.jsx("span",{className:"text-yellow-400 font-semibold",children:"價格"}),e.jsxs("span",{children:["= HQ",m?"最低價":"平均價"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{children:"= 複製名稱"})]})]})]}):e.jsx("div",{className:"p-4 text-center text-gray-400",children:"無製作配方"})}export{ie as default};
