# OCR 文件大小和加载策略分析

## 文件大小概览

### Tesseract.js 核心文件
- `tesseract-core.wasm.js`: ~4.5 MB
- `tesseract-core.wasm`: ~3.3 MB  
- `worker.min.js`: ~120 KB
- **小计**: ~7.9 MB

### gumblex/tessdata_chi 模型
- `chi_tra.traineddata`: ~64 MB
- **总计**: ~72 MB

## 加载策略分析

### ✅ 按需加载（Lazy Loading）

**重要**: Tesseract 文件**不会**在页面加载时自动下载！

#### 1. 页面初始加载
- ✅ **只加载**: `tesseract.min.js` (~65 KB) - 从 CDN 加载
- ✅ **不加载**: WASM 文件、Worker 文件、模型文件
- ✅ **影响**: 页面初始加载时间几乎不受影响

#### 2. OCR 功能触发时
只有当用户**点击 OCR 按钮**并**选择图片**后，才会：
1. 创建 Tesseract Worker
2. 按需加载 WASM 文件（~7.9 MB）
3. 按需加载模型文件（~64 MB）

### 加载时机

```javascript
// 代码位置: src/components/OCRButton.tsx

// ❌ 不在页面加载时执行
// ✅ 只在用户点击 OCR 按钮时执行
async function performOCR(image: HTMLImageElement) {
  // 此时才开始加载文件
  const worker = await window.Tesseract.createWorker(CONFIG.tesseractLang, 1, workerOptions);
  // ...
}
```

## 用户体验影响

### 首次使用 OCR
- **等待时间**: 约 10-30 秒（取决于网络速度）
- **下载内容**: ~72 MB
- **用户体验**: 显示进度条，用户知道正在加载

### 后续使用 OCR
- **等待时间**: 几乎立即（浏览器缓存）
- **下载内容**: 0 MB（使用缓存）
- **用户体验**: 快速响应

### 不使用 OCR 的用户
- **下载内容**: 0 MB（完全不加载）
- **页面加载**: 不受影响

## 浏览器缓存

### HTTP 缓存策略
GitHub Pages 会自动设置缓存头：
- WASM 文件: 长期缓存
- 模型文件: 长期缓存
- Worker 文件: 长期缓存

### 缓存效果
- **首次访问**: 下载 ~72 MB
- **后续访问**: 使用缓存，几乎不下载
- **缓存失效**: 仅在文件更新时（很少发生）

## 优化建议

### 当前架构优势 ✅
1. **按需加载**: 不影响页面初始加载
2. **智能缓存**: 浏览器自动缓存，后续使用快速
3. **用户控制**: 只有需要 OCR 的用户才会下载

### 可选优化方案

#### 1. 预加载提示（可选）
```html
<!-- 在用户可能使用 OCR 时预加载 -->
<link rel="prefetch" href="/tesseract/tesseract-core.wasm.js" />
```

#### 2. 渐进式加载（已实现）
- 先加载核心文件
- 再加载模型文件
- 显示加载进度

#### 3. CDN 回退（已实现）
- 如果本地文件加载失败，可以切换回 CDN
- 配置: `useCDN: true`

## 性能对比

### 使用本地文件（当前）
- **首次 OCR**: ~72 MB 下载，10-30 秒
- **后续 OCR**: 使用缓存，< 1 秒
- **页面加载**: 不受影响

### 使用 CDN（备选）
- **首次 OCR**: ~72 MB 下载，10-30 秒
- **后续 OCR**: 使用缓存，< 1 秒
- **页面加载**: 不受影响
- **准确度**: 略低（官方模型）

## 总结

### ✅ 用户访问 GitHub Pages 时：
1. **页面加载**: 只加载 ~65 KB 的 tesseract.min.js（从 CDN）
2. **不使用 OCR**: 完全不加载大文件
3. **使用 OCR**: 按需加载 ~72 MB（首次），后续使用缓存

### ✅ 优势：
- 不影响普通用户的页面加载速度
- 只有使用 OCR 的用户才会下载大文件
- 浏览器缓存确保后续使用快速
- 自动使用最新版本的优化模型

### 📊 数据：
- **页面初始加载**: +65 KB（可忽略）
- **首次 OCR 使用**: +72 MB（按需）
- **后续 OCR 使用**: 0 MB（缓存）

## 建议

当前架构已经是最优的：
- ✅ 按需加载，不影响页面性能
- ✅ 智能缓存，后续使用快速
- ✅ 用户友好，显示加载进度

**无需额外优化**，除非有特殊需求。
