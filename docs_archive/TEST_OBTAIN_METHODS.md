# ObtainMethods 組件測試文檔

## 測試目標

驗證 ObtainMethods 組件已成功遷移到 Supabase 架構，所有數據都從 Supabase 加載，不再依賴本地 JSON 文件。

## 測試前準備

1. 確保 Supabase 數據庫已同步所有必要的表
2. 確保應用已構建成功：`npm run build`
3. 啟動開發服務器：`npm run dev`

## 測試步驟

### 1. 基礎功能測試

#### 測試項目 1.1: 基本數據加載
- **步驟**：
  1. 打開瀏覽器開發者工具（Console）
  2. 導航到物品頁面，例如：`/item/36221`（精金投斧）
  3. 觀察 Console 日誌

- **預期結果**：
  ```
  [Supabase] 📥 Loading extracts for item 36221 from Supabase...
  [ObtainMethods] 📊 Extracted IDs for item 36221: { npcIds: X, shopIds: Y, ... }
  [ObtainMethods] 🚀 Executing N parallel queries for item 36221...
  [Supabase] 📥 Loading tw_npcs for X IDs...
  [Supabase] ✅ Loaded tw_npcs: X items
  [ObtainMethods] ✅ Loaded twNpcs: X items
  ...
  ```

- **驗證點**：
  - ✅ 看到 Supabase 查詢日誌
  - ✅ 看到 ID 提取日誌
  - ✅ 看到批量查詢執行日誌
  - ✅ 看到數據加載完成日誌
  - ✅ 組件正常渲染，無錯誤

#### 測試項目 1.2: 組件渲染
- **步驟**：
  1. 等待數據加載完成
  2. 檢查頁面上的 ObtainMethods 組件

- **預期結果**：
  - ✅ 顯示 "載入取得方式..." 加載狀態
  - ✅ 加載完成後顯示取得方式列表
  - ✅ 無空白頁面或錯誤訊息

### 2. 數據顯示測試

#### 測試項目 2.1: NPC 數據顯示
- **測試物品**：選擇有 NPC 商店的物品（如 36221）
- **驗證點**：
  - ✅ NPC 名稱正確顯示（繁體中文）
  - ✅ NPC 標題正確顯示
  - ✅ NPC 位置信息正確顯示
  - ✅ 地圖標記功能正常

#### 測試項目 2.2: 商店數據顯示
- **測試物品**：選擇有商店兌換的物品
- **驗證點**：
  - ✅ 商店名稱正確顯示
  - ✅ 貨幣名稱正確顯示
  - ✅ 兌換數量正確顯示
  - ✅ 任務需求正確顯示

#### 測試項目 2.3: 副本數據顯示
- **測試物品**：選擇有副本掉落的物品
- **驗證點**：
  - ✅ 副本名稱正確顯示（繁體中文）
  - ✅ 副本圖標正確顯示
  - ✅ 副本類型圖標正確（地牢/試煉/零式等）
  - ✅ 簡體中文名稱用於維基連結

#### 測試項目 2.4: 任務數據顯示
- **測試物品**：選擇有任務獎勵的物品
- **驗證點**：
  - ✅ 任務名稱正確顯示
  - ✅ 任務圖標正確顯示
  - ✅ 任務等級正確顯示
  - ✅ 任務職業類別正確顯示

#### 測試項目 2.5: FATE 數據顯示
- **測試物品**：選擇有 FATE 獎勵的物品
- **驗證點**：
  - ✅ FATE 名稱正確顯示
  - ✅ FATE 圖標正確顯示
  - ✅ FATE 等級正確顯示
  - ✅ FATE 位置信息正確顯示
  - ✅ 獎勵物品列表正確顯示

#### 測試項目 2.6: 成就數據顯示
- **測試物品**：選擇有成就獎勵的物品
- **驗證點**：
  - ✅ 成就名稱正確顯示
  - ✅ 成就描述正確顯示
  - ✅ 成就圖標正確顯示
  - ✅ 懸停提示正常顯示

### 3. 性能測試

#### 測試項目 3.1: 加載時間
- **步驟**：
  1. 打開 Network 標籤
  2. 清除緩存
  3. 加載物品頁面
  4. 記錄加載時間

- **預期結果**：
  - ✅ 首次加載時間 < 2 秒（取決於網絡速度）
  - ✅ 後續加載使用緩存，時間 < 500ms
  - ✅ 無大量重複請求

#### 測試項目 3.2: 數據量驗證
- **步驟**：
  1. 檢查 Console 日誌中的數據計數
  2. 驗證只加載了必要的數據

- **預期結果**：
  - ✅ 只查詢了 sources 中實際需要的 IDs
  - ✅ 無加載整個表的查詢
  - ✅ 批量查詢數量合理（< 20 個並行查詢）

### 4. 錯誤處理測試

#### 測試項目 4.1: 無數據情況
- **測試物品**：選擇沒有取得方式數據的物品
- **預期結果**：
  - ✅ 顯示 "暫無取得方式資料"
  - ✅ 無錯誤訊息
  - ✅ 組件正常渲染

#### 測試項目 4.2: 網絡錯誤
- **步驟**：
  1. 斷開網絡連接
  2. 嘗試加載物品頁面

- **預期結果**：
  - ✅ 顯示適當的錯誤訊息
  - ✅ 組件不會崩潰
  - ✅ 可以重試

#### 測試項目 4.3: 無效物品 ID
- **測試物品**：使用無效的物品 ID（如 999999）
- **預期結果**：
  - ✅ 正常處理，顯示 "暫無取得方式資料"
  - ✅ 無錯誤訊息

### 5. 邊界情況測試

#### 測試項目 5.1: 大量數據
- **測試物品**：選擇有大量取得方式的物品
- **驗證點**：
  - ✅ 所有數據正確加載
  - ✅ 組件正常渲染
  - ✅ 無性能問題

#### 測試項目 5.2: 快速切換物品
- **步驟**：
  1. 快速切換多個物品頁面
  2. 觀察數據加載

- **預期結果**：
  - ✅ 取消之前的請求（abort）
  - ✅ 只加載當前物品的數據
  - ✅ 無重複請求

### 6. 測試物品清單

建議測試以下物品以覆蓋各種取得方式：

| 物品 ID | 物品名稱 | 測試類型 |
|---------|---------|---------|
| 36221 | 精金投斧 | 製作、NPC商店、副本 |
| 10001 | 基礎物品 | 基本功能 |
| 20000 | 任務獎勵物品 | 任務 |
| 30000 | FATE 獎勵物品 | FATE |
| 40000 | 成就獎勵物品 | 成就 |
| 50000 | 兌換物品 | 商店兌換 |

## 測試檢查清單

- [ ] 基礎功能測試通過
- [ ] 所有數據類型正確顯示
- [ ] 性能測試通過
- [ ] 錯誤處理正常
- [ ] 邊界情況處理正常
- [ ] 無 Console 錯誤
- [ ] 無網絡錯誤
- [ ] 緩存正常工作
- [ ] 組件正常卸載和清理

## 已知問題

（測試完成後記錄任何發現的問題）

## 測試結果

**測試日期**：_____________  
**測試人員**：_____________  
**測試狀態**：□ 通過  □ 失敗  □ 部分通過  

**備註**：
_________________________________________________
